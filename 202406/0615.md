# TIL (Today I Learned)

# 6월 15일 토요일

# 😃 What I Learned

## ✨오늘 진행한 내용

- [x]  채용공고 확인 (10분)
- [x]  네이버 부스트캠프 1차 코딩 테스트
- [x]  알고리즘 문제 풀이
    - [x]  리코쳇 로봇
    - [x]  공 이동 시뮬레이션
- [x]  MQTT 프로토콜 공부

## ✨오늘 공부한 내용

### MQTT 프로토콜

- 2016년 국제 표준화
- 작은 코드 공간이 필요하거나 네트워크 대역폭이 제한되는 원격 통신
- IoT와 같이 제한된, 혹은 대규모 트래픽 전송을 위해 만들어진 프로토콜
- TCP/IP 위에서 동작하지만 매우 가벼우며 많은 통신 제약을 해결
    - 즉  Wifi 등의 인터넷을 기반으로 메시지를 송수신
    - 이러한 장점으로 Facebook이 채택, 우아한 형제들에서도 MQTT 도입 시도한 이력
        - 수 많은 사용자를 보유한 페이스북은 서버에 세션을 만들고 관리 하는 것만으로도 상당한 부하가 발생 하기 때문에 MQTT를 도입했다. MQTT는 채팅방을 하나의 토픽으로 지정하고, 채팅에 참여한 사용자를 각각 발행자와 구독자로 메시지를 전달하게 한 뒤 MQTT 브로커가 메시지를 전달하는 구조로 세션 관리에 대한 부하를 분산 시킨다.
        - 여기서 메세지 순서 관리를 위해 브로커 구현에 신경을 써야 함
        - [배달 로봇 등에 아직 사용하긴 하네욤](https://csj000714.tistory.com/950)
- 그러나 메세지가 가벼운 만큼 메세지 유형이나 QoS에서는 제약 존재

특징

- 연결 지향적
    - 클라이언트 - 브로커간 TCP/IP 소켓 연결 → 명시적으로 연결을 끊거나 네트워크로 인해 끊어지기 전까지 유지
    - 하트비트 (Live)
    - 재접속 가능
- 브로커를 통한 통신
    - 발행-구독 메시징 패턴 : 브로커를 통해서만 통신 가능
    - 개설된 Topic에 메세지 발행 → Topic 구독하는 클라이언트들에게 메세지 발행 가능
- QoS (Quality of Service)
    - 0
        - 보낸 다음 잊어버림
        - 최대 1회 전송
    - 1
        - 확인 응답은 거침
        - 최소 1회 전송
        - 구독하는 클라이언트가 메세지를 받았는지 불확실하면 정해진 횟수만큼 재전송
        - 메세지 핸드쉐이킹 과정 없어 중복 위험성 존재
    - 2
        - 보장된 전달
        - 구독하는 클라이언트가 요구된 메세지를 정확히 “한 번” 수신하도록 보장
        - 메세지 핸드쉐이킹 과정 통해 추적
        - 높은 품질 보장하나 성능 희생
    - 글자수 제한 없음 (JSON, 긴 텍스트 가능)
    - **보통 0~1의 QoS 사용하고 메세지 손실 리스크는 상위 어플리케이션 차원에서 해결한다**
- 다양한 개발언어 클라이언트 지원
- SSL 프로토콜 사용

토픽

- / 로 구분되는 계층 구조. **주의할 점은 PC 디렉토리와 다르게 최상위 계층이 / 로 시작되지 않는다**
- +는 와일드 카드
- #는 Multi Level 와일드 카드로 맨 마지막에만 사용 가능
- $ 로 시작시 시스템에 사용되는 특수한 토픽으로 지정. 브로커 내부 메세지를 위해 주로 사용

중요한 이유

1. **디바이스 ↔ 클라우드**
2. **가볍고 효율적**
    1. 가장 작은 MQTT 제어 메세지가 2바이트. 12바이트의 가변 헤더까지 가능
    2. 헤더도 매우 작아 네트워크 대역폭을 최적화 가능
3. **확장성**
    1. 최소량의 코드와 작은 전력만 소비
    2. 동시에 수백만개의 디바이스 연결 가능
4. **신뢰성**
    1. 재연결 & QoS 레벨 지정 가능
5. **보안**
    1. 메세지 손쉽게 안호화. OAruth, TLS1.2, 고객 관리형 인증서 등 인증 프로토콜 사용 가능
6. **우수한 지원**

### 우아한 형제들[중계시스템]에서 사용했던 MQTT Broker

*AWS ElasticBeanstalk + Node.js*

*Module : mosca (Node.js용 module인 mosca를 사용했습니다.)*

*구조가 단순하지만 필요한 기능의 지원은 모두 가능하고 사용 환경에 따라 customizing 하기도 용이합니다.*

*필요에 따라 REDIS나 MongoDB를 활용한 storage option도 지원합니다.*

*AWS IoT는 비용이 너무 들어서 포기했다고 한다*

문제 발생 경험

1. 추진과정에서 스마트폰의 최근 OS에서 battery와 memory의 효과적 관리를 위한 보호모드로 인해 MQTT 접속이 지속될 수 없음을 확인하게 됩니다. → 대기모드에 들어가면 메세지를 못받게 됨
2. 현재 사용하고 있는 단말기가 가진 구조적 한계가 있습니다. 이로인해 단말기도 현재로서는 MQTT를 적용할 수 없습니다.

이후 사용하지 않는듯..

[https://techblog.woowahan.com/2540/](https://techblog.woowahan.com/2540/)

[https://techblog.woowahan.com/2543/](https://techblog.woowahan.com/2543/)

### 참고

[https://underflow101.tistory.com/22](https://underflow101.tistory.com/22)

[https://doosan.tistory.com/185](https://doosan.tistory.com/185)

## ✨내일 진행할 내용

- [ ]  스터디 주제 추가 공부
    - [ ]  DDD란?
    - [ ]  CQRS 수준 & 이벤트 → 김영한 배민 강의
- [ ]  월요일에 3시 반 신한은행 상담
- [ ]  가상 면접 사례로 배우는 대규모 시스템 설계 기초 4 ~ 6강 공부
- [ ]  테스트 강의
- [ ]  채점 서버 구현 준비

# 😜 Today’s Small Happiness

# 🧐 Let’s Think About It

# 🙀 Got Stuck..