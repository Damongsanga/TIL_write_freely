# TIL (Today I Learned)

# 2ì›” 29ì¼ ëª©ìš”ì¼

# ğŸ˜ƒÂ What I Learned

## í”„ë¡œì íŠ¸ ì§„í–‰ ìƒí™©

## âœ¨ì˜¤ëŠ˜ ì§„í–‰í•œ ë‚´ìš©

## âœ¨ë‚´ì¼ í•´ì•¼í•  ê²ƒ

- docker-compose ê°€ ë¬´ì—‡ì¸ì§€ & ì„¤ì • ë°©ë²• ì•Œì•„ë³´ê¸°
- ì»¨í…Œì´ë„ˆ ë§Œë“¤ì–´ì„œspringboot ë§Œë“¤ì–´ì„œ Jenkins ë¡œ ë¹Œë“œ ëŒë ¤ë³´ê¸°
    - [https://seongwon.dev/DevOps/20220717-CICDêµ¬ì¶•ê¸°2/](https://seongwon.dev/DevOps/20220717-CICD%EA%B5%AC%EC%B6%95%EA%B8%B02/)
- Jenikns SSH ì—°ë™í•˜ê¸°

## âœ¨ë°°ìš´ ë‚´ìš©

## CD í”Œë¡œìš° ì •ë¦¬

- ì™œ jenkins/home ?
    - jenkins ëŒë©´ì„œ ë¡œê·¸ë‚˜ íŒŒì¼ë“¤ì´ ìƒì„±ë  ìˆ˜ ìˆê³  ì´ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤
- jenkins í´ë”ì— ê°ê°ì˜ dockerfileì´ ì¡´ì¬í•´ì•¼í•¨
- ì´ê±¸ë¡œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  build í•˜ëŠ”ë° ê·¸ëŸ° ì½”ë“œê°€ jenkins íŒŒì´í”„ë¼ì¸ ì½”ë“œì— ë“¤ì–´ìˆìœ¼ë©´ ë¨
- ë§Œì•½ docker-composeë¥¼ ì“°ë©´ ê·¸ ì½”ë“œê°€ íŒŒì´í”„ë¼ì¸ì— ë“¤ì–´ìˆê³ , docker-composeê°€ dockerfileì— ì ‘ê·¼í•´ì„œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³  buildí•  ê²ƒì„

## **ì™œ dindê°€ dood ë³´ë‹¤ ë³´ì•ˆì ìœ¼ë¡œ ì•ˆ ì¢‹ì€ê°€????**

[https://rainbound.tistory.com/entry/docker-in-docker](https://rainbound.tistory.com/entry/docker-in-docker)

### Docker in Docker

[https://velog.io/@donggu/ë„ì»¤-Docker-in-Docker](https://velog.io/@donggu/%EB%8F%84%EC%BB%A4-Docker-in-Docker)

- ë„ì»¤ ë‚´ì—ì„œ ë„ì»¤ ë°ëª¬ì„ ì‹¤í–‰í•˜ëŠ” ë°©ì‹
- ë°©ë²•
    - ìš°ì„ ì ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œë„ docker clië¥¼ ë„£ì–´ì•¼ í•¨
    
    ```bash
    apt-get install -y docker-ce-cli
    ```
    
    - ë„ì»¤ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ë„ì»¤ ë°ëª¬ì„ ì¶”ê°€ë¡œ ë™ì‘
    - ë„ì»¤ ë°ëª¬ì— ì¶”ê°€ ê¶Œí•œ í•„ìš”
        
    - ìœ„ ê·¸ë¦¼ ê¸°ì¤€ìœ¼ë¡œ jenkinsëŠ” root ìœ ì €ë„ ì•„ë‹ˆê³  994ë¼ëŠ” ê·¸ë£¹ì—ë„ ì†í•´ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— dockerë¼ëŠ” ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ë‹¤.
    - ì•„ë˜ ì½”ë“œì—ì„œëŠ” dind1ë¼ëŠ” ìœ ì €ë¥¼ ë“±ë¡í•´ì£¼ê² ë‹¤.
    
    ```bash
    docker run --privileged --name dind1 -d docker:20.10.5-dind
    ```
    
    - ë„ì»¤ ì•ˆì— ê²©ë¦¬ëœ í™˜ê²½ì„ ë§Œë“¤ ìˆ˜ ìˆìŒ
    - ì´í›„
    
    ```bash
    $ docker run -it -v /var/run/docker.sock:/var/run/docker.sock docker
    ```
    
    - ë³´ì•ˆìƒì— ë¬¸ì œë¡œ ì¶”ì²œë˜ì§€ ì•ŠìŒ
        - --privileged ì˜µì…˜ì€ DockerëŠ” í˜¸ìŠ¤íŠ¸ì˜ ëª¨ë“  ì¥ì¹˜ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê¶Œí•œì„ ë¶€ì—¬
        - **ë”°ë¼ì„œ ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ ì „ì²´ ê¶Œí•œì„ ê°–ëŠ” ë¬¸ì œê°€ ìƒê¹€**
        - ì¦‰, ë„ì»¤ë¥¼ ì»¨íŠ¸ë¡¤í•˜ëŠ” ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ì— ë¯¸ì¹  ì˜í–¥ì´ í¬ë‹¤

### Docker out of Docker

- ì‚¬ìš©ì¤‘ì¸ ë„ì»¤ì˜ ê¸°ëŠ¥ì„ ë¹Œë ¤ì„œ ì‚¬ìš©
- ë‚´ë¶€ì— ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì§€ ì•Šê³  ê¸°ì¡´ì˜ ì‚¬ìš©í•˜ë˜ ì»¨í…Œì´ë„ˆë¥¼ ì¶”ê°€ë¡œ ìƒì„±
- dockerë¥¼ ì‚¬ìš©í•´ë³´ë©´ ê´€ë¦¬ì ê¶Œí•œ ì—†ì´ ì‹¤í–‰í–ˆì„ ë•Œ /var/run/docker.sockì— ëŒ€í•œ ê¶Œí•œì´ ì—†ë‹¤ëŠ” ë©”ì‹œì§€
- í•´ë‹¹ íŒŒì¼ì´ íŒŒì¼ì´ ë¡œì»¬ ì‹œìŠ¤í…œì—ì„œ ë„ì»¤ ë°ëª¬ê³¼ í†µì‹ í•  ìˆ˜ ìˆëŠ” ì†Œì¼“ íŒŒì¼

```bash
$ docker run -it -v /var/run/docker.sock:/var/run/docker.sock docker-ce ??
```

- **ìƒì„¸**
    
    í˜¸ìŠ¤íŠ¸ì˜ **`/var/run/docker.sock`** íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ **`/var/run/docker.sock`** íŒŒì¼ì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. ì´ê²ƒì€ Docker ì†Œì¼“ì— ëŒ€í•œ ì ‘ê·¼ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. Docker ì†Œì¼“ì€ Docker ë°ëª¬ì— ëŒ€í•œ UNIX ì†Œì¼“ì…ë‹ˆë‹¤. 
    
    ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ í˜¸ìŠ¤íŠ¸ì˜ Docker ë°ëª¬ê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ë¡œ Docker ì»¨í…Œì´ë„ˆì—ì„œ Docker ëª…ë ¹ì„ ì‹¤í–‰í•˜ê±°ë‚˜ Docker APIë¥¼ ì‚¬ìš©í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    
- í•´ë‹¹ ë„ì»¤ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ì´ ë„ì»¤ ëª…ë ¹ì€ í˜¸ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰ì¤‘ì¸ ë„ì»¤ ë°ëª¬ì—ê²Œ ì „ë‹¬ë¨
- ì´ ë°©ì‹ì´ ë³´ì•ˆì ìœ¼ë¡œ ë¬´ì¡°ê±´ ì•ˆì „í•œ ê²ƒì€ ì•„ë‹˜
    - ê³µê²©ì„ í•˜ëŠ” ë°©í–¥ì´ ë°”ë€” ë¿ ë§‰ê°•í•œ ê¶Œí•œì„ ê°–ëŠ” ê²ƒì€ ë™ì¼
    - ë‹¨ì ì¸ ì˜ˆë¡œ -v ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ì›ê²© í˜¸ìŠ¤íŠ¸ì˜ ìì›ì„ ê³µìœ í•´ ê³µê²© ê°€ëŠ¥
    
    ```bash
    $ docker run -it -v /tmp:/tmp -v /etc/crontab:/etc/crontab --rm busybox sh
    ```
    
    - **ìƒì„¸**
        - **`v /tmp:/tmp`**: ì´ ì˜µì…˜ì€ í˜¸ìŠ¤íŠ¸ì˜ **`/tmp`** ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ **`/tmp`** ë””ë ‰í† ë¦¬ì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. ì¦‰, í˜¸ìŠ¤íŠ¸ì˜ **`/tmp`** ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
        - **`v /etc/crontab:/etc/crontab`**: ì´ ì˜µì…˜ì€ í˜¸ìŠ¤íŠ¸ì˜ **`/etc/crontab`** íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ **`/etc/crontab`** íŒŒì¼ì— ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ í˜¸ìŠ¤íŠ¸ì˜ crontab íŒŒì¼ì„ ì½ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - **`-rm`**: ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ë©´ ìë™ìœ¼ë¡œ ì œê±°ë©ë‹ˆë‹¤. ì¦‰, ì„ì‹œì ì¸ ì‘ì—…ì„ ìœ„í•´ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê³  í•´ë‹¹ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ì»¨í…Œì´ë„ˆê°€ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.
    - ì´ ëª…ë ¹ì„ ì‚¬ìš©í•´ tmpì™€ crontab íŒŒì¼ì„ ê³µìœ í•˜ê³  tmp ë””ë ‰í† ë¦¬ì— ë°±ë„ì–´ íŒŒì¼ì„ í•˜ë‚˜ ë°°ì¹˜í•˜ê³  crontabì„ ìˆ˜ì •í•´ ì‹¤í–‰ ì˜ˆì•½ì„ ê±¸ì–´ë‘”ë‹¤ë©´ í˜¸ìŠ¤íŠ¸ì˜ ëª¨ë“  í†µì œê¶Œì€ ê³µê²©ìì—ê²Œ ë„˜ì–´ê°

- **docker out of docker ì‚¬ìš© ê¶Œí•œ ì—ëŸ¬**
    
    [https://jaykos96.tistory.com/44](https://jaykos96.tistory.com/44)
    
    - ê¹ƒ ëŸ¬ë„ˆë¥¼ í†µí•´ docker in docker ì‚¬ìš©
    
    ```bash
    docker run --detach \
    --name gitlab-runner \
    --restart always \
    --volume /srv/gitlab-runner/config:/etc/gitlab-runner: \
    --volume /var/run/docker.sock:/var/run/docker.sock \ # Docker in Docker ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë³¼ë¥¨
    gitlab/gitlab-runner:latest
    ```
    
    - ***permission denied while trying to connect to the Docker daemon socket at â€¦.***
    - ì´ ì—ëŸ¬ëŠ” ì™œ ë°œìƒí•˜ëŠ”ê°€?
        - ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ hostì˜ group-idëŠ” ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, group ìì²´ì™€ í•„ìš”í•œ groupì˜ ì‚¬ìš©ìì¸ gitlab-runnerê°€ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸
        
        ```bash
        cat /etc/group | grep docker
        ```
        
    - í•´ê²° ë°©ë²•
        - ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ hostì— ì¡´ì¬í•˜ëŠ” ë™ì¼í•œ ì‚¬ìš©ì ê·¸ë£¹ì„ ë§Œë“¤ê³  Docker í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ê¶Œí•œì´ í•„ìš”í•œ ìœ ì €ë¥¼ ê·¸ë£¹ì— ì¶”ê°€í•´ì¤Œ
        
        ```bash
        groupadd docker # ë„ì»¤ë¼ëŠ” ê·¸ë£¹ ì¶”ê°€
        groupmod -g 944 docker # ì»¨í…Œì´ë„ˆì˜ ë„ì»¤ê·¸ë£¹ì— hostì˜ ë„ì»¤ ê·¸ë£³ê³¼ ë™ì¼í•œ gid ì§€ì •
        usermod -aG docker gitlab-runner # ì‚¬ìš©ì ì¶”ê°€
        ```
        

- **git clone í›„ ì»¨í…Œì´ë„ˆ ìƒì„± ê³¼ì •ì—ì„œ docker.sockì´ local ì»´í“¨í„°ì—ì„œ pathë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ë¬¸ì œ**
    
    [https://velog.io/@cucuridas/Docker-Out-of-Docker-ì—ì„œ-ë°œìƒí•˜ëŠ”-ë¬¸ì œjenkins](https://velog.io/@cucuridas/Docker-Out-of-Docker-%EC%97%90%EC%84%9C-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EB%AC%B8%EC%A0%9Cjenkins)
    
    1. jenkinsì—ì„œ git cloneì„ ì‹¤í–‰ ì‹œ ìƒì„±ë˜ëŠ” /var/jenkins_home ë””ë ‰í† ë¦¬ë¥¼ local ì»´í“¨í„° í™˜ê²½ì—ë„ ë˜‘ê°™ì´ ìƒì„±
    2. local ì»´í“¨í„° í™˜ê²½ì— ìƒì„±ëœ /var/jenkins_homeë¥¼ jenkins container ë‚´ë¶€(/var/jenkins_home)ë¡œ bind mount
    
    ```bash
    # 1. ë¡œì»¬ ì»´í“¨í„°ì—ì„œ /var/jenkins_home ë””ë ‰í† ë¦¬ ìƒì„±
    mkdir -p /var/jenkins_home
    
    # 2. Jenkins ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë° /var/jenkins_home ë°”ì¸ë“œ ë§ˆìš´íŠ¸
    docker run -d \
      -v /var/jenkins_home:/var/jenkins_home \
      --name my-jenkins \
      jenkins/jenkins:latest #GPT ìŠ¤í¬ë¦½íŠ¸ì„
    ```
    

- ë³´ë‹¤ ìì„¸í•œ ì˜ˆì‹œ ìˆëŠ” ë¸”ë¡œê·¸
    
    [https://www.skyer9.pe.kr/wordpress/?p=3382](https://www.skyer9.pe.kr/wordpress/?p=3382)
    

### DOOD ê³¼ì •

1. **jenkins-docker ì´ë¯¸ì§€ ìƒì„±**
    1. jenkins-docker ë¼ëŠ” dirì— dockerfileì„ ë§Œë“ ë‹¤
    2. install_docker.sh ë¥¼ ìˆ˜ì •í•œë‹¤
    3. docker hubì— ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•œë‹¤ (ê³„ì •ì´ ì—†ë‹¤ë©´ ë¨¼ì € ê³„ì •ì„ ìƒì„±í•œë‹¤)
2. **ë§Œë“¤ì–´ì§„ docker image ë¡œ jenkinsë¥¼ runí•œë‹¤**
    
    ```bash
    sudo docker run --restart=on-failure --user='root' -p 3100:8080 -p 50000:50000 -v /var/jenkins_home:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock -d --name jenkins damongsanga/jenkins-docker-test:0.0.1
    ```
    
3. **í•´ë‹¹ ì»¨í…Œì´ë„ˆì— ë“¤ì–´ê°€ì„œ ë°”ê¹¥ ì»¨í…Œì´ë„ˆì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤**
    
    ```bash
    root@ip-172-31-32-115:/home/damongsanga/jenkins-docker-test# docker exec -it jenkins bash
    
    root@022cfbd4046c:/# docker ps
    CONTAINER ID   IMAGE                                   COMMAND                  CREATED             STATUS             PORTS                                                                                      NAMES
    022cfbd4046c   damongsanga/jenkins-docker-test:0.0.1   "/usr/bin/tini -- /uâ€¦"   About an hour ago   Up About an hour   0.0.0.0:50000->50000/tcp, :::50000->50000/tcp, 0.0.0.0:3100->8080/tcp, :::3100->8080/tcp   jenkins
    4f5e43fc3408   nginx                                   "/docker-entrypoint.â€¦"   3 days ago          Up 3 days          0.0.0.0:3000->80/tcp, :::3000->80/tcp                                                      webserver
    ```
    

### docker ê¹ƒë© ì—°ë™

[https://velog.io/@hanif/Dockerë¡œ-GitLab-ì„¤ì¹˜-ë°-ì ‘ì†í•˜ê¸°](https://velog.io/@hanif/Docker%EB%A1%9C-GitLab-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%A0%91%EC%86%8D%ED%95%98%EA%B8%B0)

# ğŸ˜œÂ Todayâ€™s Small Happiness

- 

# ğŸ§Â Letâ€™s Think About It

- 

# ğŸ™€Â Got Stuck..

-