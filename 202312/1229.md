# TIL (Today I Learned)

# 12ì›” 29ì¼ ê¸ˆìš”ì¼

# ğŸ˜ƒÂ What I Learned

## SSAFY ê³µë¶€

### ë¦¬íŒ©í† ë§ í•´ë³´ê¸°

- ë°©í•™ í”„ë¡œì íŠ¸ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§í•´ë³´ì•˜ìŒ
- ë‹¤ë§Œ.. ì´ê²Œ íš¨ìœ¨ì ì¸ ë¦¬íŒ©í† ë§ì¸ì§€ë¥¼ ëª¨ë¥´ê² ìŒ.. ã… ã…  ì¼ë‹¨ í•´ë´„!
- ê¸°ì¡´ ì½”ë“œ ë‚´ìš©
    - GPT4 ì— ì´ë¯¸ì§€ë¥¼ ì¸í’‹ìœ¼ë¡œ ë„£ì–´ prompt ìƒì„± ìš”ì²­ í•„ìš”
    - ì›í•˜ëŠ” Request í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ìŒ

```json
{
    model="gpt-4-vision-preview",
        messages=[
            {
                "role": "user",
                "content": [
                    {"type": "text", "text": "Whatâ€™s in this image?"},
                    {
                        "type": "image_url",
                        "image_url": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Gfp-wisconsin-madison-the-nature-boardwalk.jpg/2560px-Gfp-wisconsin-madison-the-nature-boardwalk.jpg",
                    },
                ],
            }
        ],
    max_tokens=300,
}
```

### ê¸°ì¡´ ì½”ë“œ

- ì½”ë“œê°€ ë³µì¡í•˜ì—¬ í•œëˆˆì— ë“¤ì–´ì˜¤ì§€ ì•ŠìŒ

```java

@Configuration
public class GPT4Config {
    // ìƒëµ

    public static String createRequestParam(String text, List<ImageRequest> urls){

        JsonArray content = new JsonArray();
        JsonObject textJson = new JsonObject();
        textJson.addProperty("type", "text");
        textJson.addProperty("text", text);
        content.add(textJson);

        for(ImageRequest imageRequest : urls){
            JsonObject imageJson = new JsonObject();
            imageJson.addProperty("type", "image_url");
            JsonObject urlJson = new JsonObject();
            urlJson.addProperty("url", imageRequest.getUrl());
            imageJson.add("image_url", urlJson);
            content.add(imageJson);
        }

        JsonObject msg = new JsonObject();
        msg.addProperty("role", "user");
        msg.add("content", content);

        JsonArray messages = new JsonArray();
        messages.add(msg);

        JsonObject body = new JsonObject();
        body.addProperty("model", MODEL);
        body.add("messages", messages);
        body.addProperty("max_tokens", MAX_TOKENS);

        return body.toString();
    }
}
```

### 2. ì¤‘ë³µ ë©”ì†Œë“œ ì¶”ì¶œ

- JsonObjectë¥¼ ìƒì„±í•˜ê³  addProperty() í•˜ëŠ” ì¤‘ë³µ ì½”ë“œë¥¼ ë©”ì†Œë“œë¡œ ëºŒ
    - key, valueê°€ ë²ˆê°ˆì•„ê°€ë©° ì…ë ¥ë˜ì•¼ í•¨ìœ¼ë¡œ í™€ìˆ˜ê°œì˜ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ë©´ IllegalArgumentException
- JsonObjectì™€ JsonArrayë¥¼ ì„œë¡œ addí•˜ëŠ” ì¤‘ë³µ ì½”ë“œë¥¼ ë©”ì†Œë“œë¡œ ëºŒ
    - add ë©”ì†Œë“œë¥¼ JsonObjectë‚˜ JsonArrayë¥¼ return í•˜ë„ë¡ ë³€ê²½

```java
@Configuration
public class GPT4Config {
    // ìƒëµ
    public static String createRequestParam(String text, List<ImageRequest> urls){

        JsonArray content = new JsonArray();
        content.add(createJson("type", "text", "text", text));

        for(ImageRequest imageRequest : urls){
            JsonObject imageJson = addJsonObject(createJson("type", "image_url"),
                    "image_url", createJson("url", imageRequest.getUrl()));
            content.add(imageJson);
        }

        JsonObject msg = addJsonObject(createJson("role", "user"),
                "content", content);
        JsonArray messages = addJsonObject(new JsonArray(), msg);

        return addJsonObject(createJson("model", MODEL, "max_tokens", MAX_TOKENS),
                "messages", messages).toString();
    }

    // Inner Methods
    // JsonObject ìƒì„±
    private static JsonObject createJson(String... keysAndValues){
        if (keysAndValues.length % 2 != 0) throw new IllegalArgumentException();
        JsonObject jsonObject = new JsonObject();
        for (int i = 0; i < keysAndValues.length; i+=2) {
            jsonObject.addProperty(keysAndValues[i], keysAndValues[i+1]);
        }
        return jsonObject;
    }

    // JsonObjectì— JsonObject add
    private static JsonObject addJsonObject(JsonObject jsonObject, String key, JsonObject value){
        jsonObject.add(key, value);
        return jsonObject;
    }

    // JsonObjectì— JsonArray add
    private static JsonObject addJsonObject(JsonObject jsonObject, String key, JsonArray value){
        jsonObject.add(key, value);
        return jsonObject;
    }

    // JsonArrayì— JsonObject add
    private static JsonArray addJsonObject(JsonArray jsonObject, JsonObject value){
        jsonObject.add(value);
        return jsonObject;
    }

}
```

### 3. ì¤‘ë³µ ë©”ì†Œë“œ Util í´ë˜ìŠ¤ë¡œ ì¶”ì¶œ

- ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œë„ ì‚¬ìš©ë  ìˆ˜ ìˆìŒìœ¼ë¡œ Utilí´ë˜ìŠ¤ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ ë©”ì†Œë“œ ì €ì¥
- í•´ë‹¹ í´ë˜ìŠ¤ëŠ” ê°ì²´ë¡œ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ private ìƒì„±ì ì„ ì–¸
- ì›ë˜ ì½”ë“œì—ëŠ” static importí•˜ì—¬ ì‚¬ìš©

```java
// static import
import static com.ssafy.imgMaker22.util.JsonUtil.addJsonObject;
import static com.ssafy.imgMaker22.util.JsonUtil.createJson;

@Configuration
public class GPT4Config {
    // ìƒëµ

    public static String createRequestParam(String text, List<ImageRequest> urls){

        JsonArray content = new JsonArray();
        content.add(createJson("type", "text", "text", text));

        for(ImageRequest imageRequest : urls){
            JsonObject imageJson = addJsonObject(createJson("type", "image_url"),
                    "image_url", createJson("url", imageRequest.getUrl()));
            content.add(imageJson);
        }

        JsonObject msg = addJsonObject(createJson("role", "user"),
                "content", content);
        JsonArray messages = addJsonObject(new JsonArray(), msg);

        return addJsonObject(createJson("model", MODEL, "max_tokens", MAX_TOKENS),
                "messages", messages).toString();
    }
}
```

```java
// JsonUtil í´ë˜ìŠ¤ë¡œ ë”°ë¡œ ëºŒ
public class JsonUtil {

    // ê°ì²´ ìƒì„±ë˜ì§€ ì•Šë„ë¡ (ì •ì  ë©”ì†Œë“œë§Œ ì œê³µ)
    private JsonUtil(){};

    // JsonObject ìƒì„±
    public static JsonObject createJson(String... keysAndValues){
        if (keysAndValues.length % 2 != 0) throw new IllegalArgumentException();
        JsonObject jsonObject = new JsonObject();
        for (int i = 0; i < keysAndValues.length; i+=2) {
            jsonObject.addProperty(keysAndValues[i], keysAndValues[i+1]);
        }
        return jsonObject;
    }

    // JsonObjectì— JsonObject add
    public static JsonObject addJsonObject(JsonObject jsonObject, String key, JsonObject value){
        jsonObject.add(key, value);
        return jsonObject;
    }

    // JsonObjectì— JsonArray add
    public static JsonObject addJsonObject(JsonObject jsonObject, String key, JsonArray value){
        jsonObject.add(key, value);
        return jsonObject;
    }

    // JsonArrayì— JsonObject add
    public static JsonArray addJsonObject(JsonArray jsonObject, JsonObject value){
        jsonObject.add(value);
        return jsonObject;
    }
}
```

# ğŸ˜œÂ Todayâ€™s Small Happiness

- ì”¨í”¼ì¹´ í‚¤ë¼ë¼ ë¯¸ì³..

# ğŸ§Â Letâ€™s Think About It

- 

# ğŸ™€Â Got Stuck..