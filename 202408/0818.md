# TIL (Today I Learned)

# 8월 18일 일요일

# 😃 What I Learned

## ✨오늘 진행한 내용

- [x]  AWS 공부 완료

## 공부한 내용

### IAM

- Root 계정
    - 모든 권한 가짐
    - 최대한 자제, IAM 키로 제한된 기능 사용해야
- IAM 계정
    - AWS 리소스를 안전하게 관리하기 위한 서비스
    - 주어진 권한 내의 작업만 할 수 있음

### MFA (다중인증)

- 용자에게 암호 이외의 추가 정보를 입력하도록 요구하는 다중 단계 계정 로그인 과정
- 예시로 이메일 전송 코드 입력, 보안 질문 응답, 지문 스캔 등 (2번째 인증 양식임!)
- 은행에서 OTP 사용하는 것도 동일한 방법
- Google Authenticator 사용해서! 다중 인증하면 된다
- [방법](https://velog.io/@dldldl1022/AWS-%EB%8B%A4%EC%A4%91%EC%9D%B8%EC%A6%9DMFA-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0)

### Region / AZ, Edge Location / Cache

1. Region
    - 네트워크 속도 및 각종 재해 대비를 위해 구분하는 **서버의 물리적인 국가/도시 단위**
    - IDC의 집합체 (Internet Data Center)
    - 법률 규제도 준수하기 위함도 있음
    - 리전마다 가격, 서비스가 다를 수 있음
2. AZ (Available Zones)
    - 각 리전 안의 데이터센터 (서버 컴퓨터들이 모여있는 건물)
    - 기본적으로 AWS의 각 리전 안에는 2개 이상의 가용영역 존재 (서울은 2개)
    - 물리적으로 떨어져있어 1개의 데이터센터가 죽어도 서비스 운영을 위함
    - 그러나 모든 AZ는 서로 100km 이내에 위치해야함 (광통신 전용망에 따른 속도)
    - 가용영역은 매핑 정보로 실제 데이터센터와 1대1로 매핑되지 않는다, 내 계정의 가용영역 A는 다른 계정의 가용영역 A와 데이터 저장센터 위치는 다르다.
3. Edge Location
    - cdn들의 여러 서비스들을 가장 빠른 속도로 캐싱하기 위한 거점
    - AZ와 별개로 AWS 의 CDN 서비스인 CloudFront와 AWS DNS 서비스인 Route53의 캐시 서버를 의미
    - Original Data ↔ **Edge Location** ↔ 사용자 End Point
    - CDN이란?
        - 속도 개선과 회선 비용 절감을 위해 End Point에 물리적으로 가까운 곳에서 데이터 제공하는 방법
        - 최초 요청 시에는 서버로부터 콘텐츠를 가져와 고객에게 전송하며, 동시에 CDN 캐싱장비에 저장
        이후에는 CDN 캐싱 장비에 저장된 콘텐츠를 바로 전송하는 방식
4. Cache
    - CDN과 Edge Location 사이에 위치
    - 서비스 이용 시에 Edge Location 에 컨텐츠가 없으면 리전별 엣지 캐시에서 검색 시도
    - CDN 서비스에서의 엣지로케이션과 비슷한 개념

### VPC, Subnet

- VPC : 사용자가 정의하는 AWS 계정 사용자 전용 가상의 네트워크
    - AWS 용 나만의 개인 네트워크 망 데이터 센터 (IP 주소 범위 선택, 서브넷 생성, 라우팅 테이블, 네트워크 게이트웨이 구성)
    - 모든 서비스에 VPC 적용하도록 강제

- Aws Clound - Region [VPC] - 2 개의 AZ - 각각 서브넷
- VPC는 Region당 1개씩으로 다른 Region과 걸쳐 확장 불가능 (Region에 종속)
- 한 Region 안에 VPC 를 여러개 설치하면 IP가 겹치면 안됨
- 유의할 점으로 AWS에서는 /16 ~ /28 비트 서브넷 마스크만 허용
- VPC 설정 IP 대역은 수정 불가
- 각각 VPC는 독립적임으로 서로 통신 불가능, 통신하려면 VPC 피어링 서비스 사용해야

- AWS Subnet
    - VPC의 IP 주소를 나누어 리소스가 배치되는 물리적인 주소 범위
    - 하나의 AZ에서만 생성 가능
    - VPC를 나눈 것임으로 당연히 VPC 보다 대역폭이 낮아야 한다
    - 네트워크 이론에서 호스트 맨 첫 주소, 마지막 주소는 사용할 수 없는데 AWS에서는 자체 서비스에 이용되는 **3개의 호스트가 추가로 있어 (10.0.0.1 - VPC 라우터, 10.0.0.2 - DNS 서버 주소, 10.0.0.3 - AWS 에서 앞으로 사용하려고 예약) 총 5개를 사용하지 못한다**
    - 기본적으로 subnet은 private이고, public 인지는 뒤에 설명할 인터넷 게이트웨이를 라우팅 테이블에 등록여부에 따른다.
    - private, public 서브넷은 다른 AZ에 설정해도 되나 굳이 추가적인 네트워크 트래픽을 탈 필요가 없다

- 라우팅 테이블
    - 각각의 subnet이 서로 다른 네트워크 영역에 있음으로, 서로로 가기 위해서 라우팅이 필요
    - 트래픽이 발생하면,
    **CIDR 10.0.0.0/16 (10.0.0.1 ~ 10.0.255.255) 아이피들은 local로 보내달라**
    다른 ***모든 대역들(0.0.0.0/0)는 인터넷 게이트웨이(igw-092d..)를 통해 바깥으로 보내달라***
    - 만일 10.0.0.6의 인스턴스로 오면 로컬에서 찾으라는 말이다. 그리고 아래에는 10.0.0.0/16 대역 이외의 모든 인터넷 트래픽(0.0.0.0/0) 은 인터넷 게이트웨이(igw)로 가라고 매핑 되어 있다.
        - 0.0.0.0은 보통 서브넷 마스크 0.0.0.0과 함께 사용되며 모든 IP를 의미
- 인터넷 게이트웨이
    - 외부 인터넷 망으로 나갈 수 있는 Routing ⇒ VPC 내부 리소스와 인터넷 간의 통신 활성화
    - 원래 VPC는 격리된 네트워크 환경으로 VPC 내부의 인스턴스들은 기본적으로는 인터넷을 사용 못함
    - **여기서 서브넷을 public으로 만든다는 의미는, 그냥 서브넷 (private) 에 인터넷게이트웨이를 라우팅 테이블에 설정하고 등록한다는 의미이다!!!**
    - 인터넷 게이트웨이는 1개의 VPC와만 연결 가능


- Subnet 개념
    - 하나의 네트워크가 분할되어 나누어진 작은 네트워크
    - IP 할당범위를 더 작은 단위로 쪼갤 수 있음. 예를 들어 IP가 100개만 필요하다면, C 클래스 (256개)를 더 쪼개어 줄 수 있음
    - 이는 서브넷 마스크를 통해 계산 (1인 부분이 네트워크, 0인 부분이 호스트)
    - 맨 첫 IP는 네트워크 주소, 맨 마지막 IP는 브로드캐스팅 주소이다
        - 192.168.1.0
        - 192.168.1.255
    - 192.168.0.1/24 (IP/서브넷마스크), 1의 갯수가 24개라는 뜻. 즉 호스트는 8비트
    - **서브네팅**
        - IP 주소를 효율적으로 나누어 사용하기 위한 바법 (자신의 네트워크 주소를 더 작은 서브네트워크로 2의 배수로 나누는 과정)
    
    
    
    - 1층에 100개, 2층에 50개, 3층에 30개의 IP를 줘야 한다면? ⇒ 큰 개수의 IP 부터 할당한다
        - 서브넷마스크를 잘 보자
            - 1층 : 11111111 11111111 11111111 10000000 ⇒ 호스트 7비트 (128)
            - 2층 : 111111111 11111111 11111111 11000000 ⇒ 호스트 6비트 (64)
            - 3층 : 111111111 11111111 11111111 11100000 ⇒ 호스트 5비트 (32)
    
    
    - 슈퍼네팅
        - 서브네팅과 반대로 네트워크를 합치는 것
        - 만약 254개 (256 - 2) 개의 호스트를 가지고 있었는데, 네트워크가 이후에 500 개의 호스트를 수용해야 한다면?
        - C 클래스를 넘어서니까 B를 통째로 주어야 하나? 그러지 말고 C 클래스 2개를 합치면 된다.
        - **192.168.10.0/24 에서 192.168.10.0/23으로 prefix숫자를 감소 ⇒ 쉽다!**
            - 아이피 : 11000000.10101000.00001010.00000000 (192.168.10.0)
            - 서브넷 마스크 : 11111111.11111111.11111110.00000000 (255.255.254.0)
        - 총 510 ( 512 - 2) 개의 IP를 가질 수 있게 된다.
    - 참조
        - [https://inpa.tistory.com/entry/WEB-IP-클래스-서브넷-마스크-서브넷팅-총정리?category=943705](https://inpa.tistory.com/entry/WEB-IP-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%84%9C%EB%B8%8C%EB%84%B7-%EB%A7%88%EC%8A%A4%ED%81%AC-%EC%84%9C%EB%B8%8C%EB%84%B7%ED%8C%85-%EC%B4%9D%EC%A0%95%EB%A6%AC?category=943705)

### NAT Gateway

- 만일 private subnet의 RDS가 외부 인터넷을 통해 업데이트해야 한다면???
- NAT Gateway와 Bastion을 통해 사설망의 구조를 유지시켜주면서 외부와 조건적으로 데이터 통신을 가능하게 함
- NAT은 대표적으로 사설 IP를 외부 인터넷과 통신하기 위해 사용됨
    - 사설 네트워크에 속한 여러개의 호스트가 하나의 공인 IP를 사용하여 인터넷에 접속하기 위함
- 인터넷 접속이 가능한 Public Subnet에 NAT Gateway를 생성하고 private subnet이 외부 인터넷으로 나가는 경우에만 라우팅 추가
- **따라서 내부에서 외부로만 접속이 가능!**
- 참고로 AWS에서 NAT Gateway는 비용 존재 (고가용성으로 인함) . 개인 포트폴리오 등에서 사용하려면 NAT 인스턴스 (그냥 EC2이다) 를 사용하여 비용을 줄이자!

참조

- [https://inpa.tistory.com/entry/AWS-📚-VPC-개념-사용-사설-IP-통신망-NAT-Gateway-Bastion-Host](https://inpa.tistory.com/entry/AWS-%F0%9F%93%9A-VPC-%EA%B0%9C%EB%85%90-%EC%82%AC%EC%9A%A9-%EC%82%AC%EC%84%A4-IP-%ED%86%B5%EC%8B%A0%EB%A7%9D-NAT-Gateway-Bastion-Host)
- [https://inpa.tistory.com/entry/WEB-🌐-NAT-란-무엇인가](https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-NAT-%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)

### Bastion

- 그렇다면 외부에서 내부로 접속해야 할 경우는 어떡하나? (ssh 등..!)
- 바스티온을 사용하자! public subnet에 위치하여 통신을 도와주는 대리인이라고 할 수 있다.

장점

- 단일 로그인 포인트 설정으로 방화벽 설계 단순화
- 네트워크 사용에 관련된 로그를 한 곳에서 관리
- 중소규모 팀에서 유용하게 사용 가능

단점

- SSH 프로토콜만 사용함으로 HTTP와 같은 어플리케이션 서비스에 사용 불가

### SSM으로 !

- 운영 효율
    - Bastion Server 운영 관리 불필요 (패치, 용량, 접근 등)
    - 신규 유저 생성 및 key pair 발급등에 대한 불편함 제거
    - **IAM 을 통한 유저 및 정책 일원화**
- 비용 최적화
    - **Bastion Server도 EC2로 비용 발생. 이를 절감 가능**
- 보안 컴플라이언스
    - **Session Manger → Session 에서 사용되는 모든 로그를 S3로 적재 → 이슈, 장애 트랙킹**

참조

- [https://inpa.tistory.com/entry/AWS-📚-VPC-개념-사용-사설-IP-통신망-NAT-Gateway-Bastion-Host](https://inpa.tistory.com/entry/AWS-%F0%9F%93%9A-VPC-%EA%B0%9C%EB%85%90-%EC%82%AC%EC%9A%A9-%EC%82%AC%EC%84%A4-IP-%ED%86%B5%EC%8B%A0%EB%A7%9D-NAT-Gateway-Bastion-Host)
- [https://jadehan.tistory.com/66](https://jadehan.tistory.com/66)
- [https://www.lgcns.com/blog/cns-tech/aws-ambassador/40899/](https://www.lgcns.com/blog/cns-tech/aws-ambassador/40899/)

## ✨내일 진행할 내용

- [ ]  SSM 연동
- [ ]  어썸님 인수인계
- [ ]  원온원 잡기
- [ ]  타운홀 미팅 듣기
- [ ]  원씽 마무리하기
- [ ]  8~11 연습
- [ ]  ~~작성!!~~
- [ ]  ~~이력관리~~
    - [ ]  ~~포트폴리오 최신화 (진행중)~~
        - [ ]  ~~분산락 내용은 최대한 뒤로 뺄 것 → 공격들어오기 좋을듯~~
        - [ ]  ~~채점 서버 구현 내용 추가~~

# 😜 Today’s Small Happiness

# 🧐 Let’s Think About It

# 🙀 Got Stuck..