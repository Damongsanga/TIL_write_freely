# TIL (Today I Learned)

# 3ì›” 13ì¼ ìˆ˜ìš”ì¼

# ğŸ˜ƒÂ What I Learned

## âœ¨ì˜¤ëŠ˜ ì§„í–‰í•œ ë‚´ìš©

- [x]  ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ image ë§Œë“¤ê¸°
- [ ]  íŒŒì´í”„ë¼ì¸ ì‘ì„±ì¤‘
    - [x]  private gitlab ê°€ì ¸ì˜¤ê³  ì´ë™ì‹œí‚¤ê¸°
    - [x]  ë©”ì¸ gitlab ê°€ì ¸ì˜¤ê¸°
    - [x]  jaríŒŒì¼ ë¹Œë“œí•˜ê¸°
    - [ ]  docker ì´ë¯¸ì§€ ë§Œë“¤ê¸° â‡’ ì—ì„œ ë§‰í˜. ë³´ë‹ˆê¹Œ docker ì‚¬ìš©ê¶Œí•œì´ ì—†ê±°ë‚˜ ì œëŒ€ë¡œ ë³¼ë¥¨ë§ˆìš´íŠ¸ ë˜ì§€ ì•Šì€ ë“¯
        
        ```bash
        + docker build . -t damongsanga/springboot:53
        /var/jenkins_home/workspace/test_pipeline_1@tmp/durable-15e7bb77/script.sh.copy: 1: docker: not found
        ```
        
    
    [ì£¼ìš” ì°¸ê³  ë¸”ë¡œê·¸](https://enginnersnack.tistory.com/11)
    
- [x]  ì¼ë‹¨ mysql ë„ìš°ê¸°
    - ë‚´ìš©
        - ì»¨í…Œì´ë„ˆ ë§Œë“¤ê¸°
            
            ```bash
            # ìˆ˜ì •
            docker volume create data_volume
            docker pull mysql:8.0.36
            docker run -d -p 3200:3306 -e MYSQL_DATABASE=flowermari -e MYSQL_USER=flowermari -e MYSQL_PASSWORD=flowermari -e MYSQL_ROOT_PASSWORD=root -v data_volume:/var/lib/mysql --name db-dev mysql:8.0.36
            ```
            
        - db í™•ì¸í•˜ê¸°
            
            ```bash
            mysql -h [í˜¸ìŠ¤íŠ¸] -u [ì‚¬ìš©ì] -p
            mysql -h localhost -u root -p
            mysql -h localhost -u flowermari -p
            
            SHOW DATABASES;
            ```
            
    
- [x]  ì¼ë‹¨ redis ë„ìš°ê¸°
- [ ]  ì¼ë‹¨ nginx ë„ìš°ê¸°
    - ë‚´ìš©
        
        **ê²Œì´íŠ¸ nginx ì„¤ì¹˜í•˜ê¸°**
        
        1. ec2ì— nginx ì„¤ì¹˜
        2. SSL ì ìš© (letsencrypt ì ìš©, but ë‚˜ëŠ” ì•ˆë¼ì„œ zerossl ì‚¬ìš©)
            
            [zeroSSLë¡œ http ì„¤ì •í•˜ê¸°.pdf](TIL%20(Today%20I%20Learned)%201fec48ac4832486f99527b3bbe49bc41/zeroSSL%25EB%25A1%259C_http_%25EC%2584%25A4%25EC%25A0%2595%25ED%2595%2598%25EA%25B8%25B0.pdf)
            
        3. 
        
        1. ubuntu container ë„ìš°ê¸°
            
            ```bash
            docker pull ubuntu:jammy
            docker run -td -p 3001:3000 -v /var/jenkins_home/settings/:/settings --user='root' --name front ubuntu:jammy
            ```
            
        2. nginx ì„¤ì¹˜í•˜ê¸°
            
            ```bash
            apt update
            apt install -y git vim net-tools sudo lsof procps
            sudo apt-get install nginx
            ```
            
        - wget ëŒ€ì‹  curl ì‚¬ìš©í•´ë„ ë¨
            
            ```bash
            apt-get install -y curl
            curl -O https://dl.eff.org/certbot-auto
            chmod a+x certbot-auto
            
            # ê·¸ëƒ¥ letsencryptë¥¼ ì„¤ì¹˜
            sudo apt update
            sudo apt-get install letsencrypt
            ```
            
        
        - letsencrypt ì‚¬ìš©
            
            ```bash
            apt list --installed | grep certbot
            sudo apt install python3-certbot-nginx
            sudo certbot --nginx -d j10a704.p.ssafy.io
            
            apt-get 
            ```
            
            - [https://velog.io/@juhyeon1114/certbot-ì„¤ì¹˜-ì‚¬ìš©ë²•-ubuntu](https://velog.io/@juhyeon1114/certbot-%EC%84%A4%EC%B9%98-%EC%82%AC%EC%9A%A9%EB%B2%95-ubuntu)
            - letsencrypt ì‚¬ìš©í•˜ë ¤ê³  í–ˆëŠ”ë° ssafy.ioì—ì„œ ë„ˆë¬´ ë§ì´ ìš”ì²­í–ˆë‹¤ê³  í•¨..
                
                ```bash
                root@b7840bcbfaf4:/# certbot certonly -d "j10a704.p.ssafy.io" --manual --preferred-challenges dns
                Saving debug log to /var/log/letsencrypt/letsencrypt.log
                Requesting a certificate for j10a704.p.ssafy.io
                An unexpected error occurred:
                There were too many requests of a given type :: Error creating new order :: too many certificates already issued for "ssafy.io". Retry after 2024-03-18T00:00:00Z: see https://letsencrypt.org/docs/rate-limits/
                Ask for help or search for solutions at https://community.letsencrypt.org. See the logfile /var/log/letsencrypt/letsencrypt.log or re-run Certbot with -v for more details.
                root@b7840bcbfaf4:/#
                
                ```
                
        - zerossl ì‚¬ìš©
            
            [zeroSSLë¡œ http ì„¤ì •í•˜ê¸°.pdf](TIL%20(Today%20I%20Learned)%201fec48ac4832486f99527b3bbe49bc41/zeroSSL%25EB%25A1%259C_http_%25EC%2584%25A4%25EC%25A0%2595%25ED%2595%2598%25EA%25B8%25B0.pdf)
            
            - íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
    
- [ ]  ì  í‚¨ìŠ¤ ë©€í‹°ë¸Œëœì¹˜ ì „ëµ ê³µë¶€
    
    [https://creampuffy.tistory.com/202](https://creampuffy.tistory.com/202)
    

### íŠ¸ëŸ¬ë¸” ìŠˆíŒ…..

- **zeroSSLì—ì„œ SSL ì¸ì¦ ì¤‘ì— nginxê°€ ì•„ì˜ˆ ì•ˆë“¤ì–´ê°€ì§**
- ì•Œê³ ë³´ë‹ˆ ë°©í™”ë²½ portë¥¼ ëš«ì§€ ì•ŠìŒ
- ì›ë˜ AWSì—ì„œ ì§ì ‘ ì¸ë°”ìš´ë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë‚˜ ìš°ë¦¬ëŠ” ssafyì—ì„œ ì œê³µí•˜ëŠ” EC2ë¥¼ ì‚¬ìš©í•´ì•¼í•´ì„œ ufwë¡œ ì§ì ‘ í¬íŠ¸ë¥¼ ëš«ì–´ì¤˜ì•¼í•¨
- ì“¸ë°ì—†ì´ ë»˜ì§“í•œ ì´ìœ ëŠ” nginxê°€ ì œëŒ€ë¡œ ì„¤ì¹˜ëŠ” ë˜ì—ˆì§€ë§Œ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ì§€ ì•Šì•„ì„œì„.. ë°˜ì„±í•˜ì
- ê³¼ì •ì€ host nginxì—ì„œ SSL ì¸ì¦ì„œë¥¼ ë°›ì•„ì„œ ë„ì»¤ì—ì„œ ê´€ë¦¬í•˜ëŠ” front nginxë¡œ ì´ë™ì‹œì¼œì¤˜ì•¼í•¨!
    - ë°›ëŠ” ê²½ë¡œëŠ” ì—¬ê¸°ë¡œ
        
        ```bash
        cd /etc/ssl (ì´ë¯¸ ìˆëŠ” ë””ë ‰í† ë¦¬ì„!)
        # ë°©ë²• 1. ë©”ëª¨ì¥ & vi í™œìš©í•´ì„œ ë³µì‚¬/ë¶™ì—¬ë„£ê¸°
        # ë°©ë²• 2. mobaXterm ì„ í™œìš©í•œ ë³µì‚¬/ë¶™ì—¬ë„£ê¸°
        ```
        

### mobaxtermìœ¼ë¡œ íŒŒì¼ ì´ë™ì‹œ ê¶Œí•œ ë¬¸ì œ

- etc/ssl ì— ì´ë™ì‹œì¼œë‘ 
- chmod 777ë¡œ ì‹¤í–‰ê¶Œí•œê¹Œì§€ ì¤˜ì•¼ë§Œ íŒŒì¼ ì´ë™ì´ë¼ëŠ” â€œì‹¤í–‰â€ê¶Œí•œì´ ìƒê¸´ë‹¤
- ì™ ì§€ ì •í™•íˆëŠ”.. ì•„ì§ ì˜ ëª¨ë¥´ê² ìŒ
    
    ![Untitled](TIL%20(Today%20I%20Learned)%201fec48ac4832486f99527b3bbe49bc41/Untitled.png)
    

- default.conf ì—°ê²°
    - ì˜¤íƒ€ ì´ìŠˆ. root, index, server_name ìˆ˜ì •
    
    ```bash
    server {
     listen 443;
    
     ssl on;
     ssl_certificate /etc/zerossl/certificate.crt;
     ssl_certificate_key /etc/zerossl/private.key;
    
     server_name j10a704.p.ssafy.io;
    
     access_log /var/log/nginx/nginx.vhost.access.log;
     error_log /var/log/nginx/nginx.vhost.error.log;
    
     location / {
            root /var/www/html;
            index index.nginx-debian.html;
     }
    }
    ```
    

## DockerFile ì•ˆì“°ê³  ë¨¼ì € í•´ë³´ì

- npm install
    - node_modulusë¡œ
- npm run build
    - dist í´ë”ì— ë‹´ê¹€

### nginx + react + docker + jenkins

```docker
FROM node:20.11.0-alpine as builder	# ë…¸ë“œë²„ì „ 20.11.0
WORKDIR /app	# ì‘ì—… ìœ„ì¹˜ ì§€ì •
ENV PATH /app/node_modules/.bin:$PATH	# í™˜ê²½ë³€ìˆ˜ ì§€ì •

COPY . /app	#í˜„ì¬ íŒŒì¼ì„ ì´ë¯¸ì§€ì˜ /app ìœ„ì¹˜ì— ë³µì‚¬
RUN npm install	#package.jsonì— ëª…ì‹œëœ ì˜ì¡´ì„± ì„¤ì¹˜
RUN npm run build	#ë¹Œë“œì‹œì‘!

#nginx 
FROM nginx:1.25.3
RUN rm -rf /etc/nginx/conf.d	#ê¸°ì¡´ í™˜ê²½ì„¤ì • ì œê±°
COPY conf /etc/nginx	#ë‚´ ë””ë ‰í† ë¦¬ì˜ confí´ë” ë‚´ìš©ì„ ë³µì‚¬
	#í˜„ì¬ìœ„ì¹˜/conf/conf.d/default.conf ê°€ ì¡´ì¬í•´ì•¼í•©ë‹ˆë‹¤.
COPY --from=builder /app/build /usr/share/nginx/html	#builderë¡œ ë¶€í„° /app/buildë¥¼ ë³µì‚¬í•´ì˜µë‹ˆë‹¤.

# 80ë²ˆ í¬íŠ¸ë¥¼ ë…¸ì¶œí•œë‹¤ê³  ì¨ë†¨ì§€ë§Œ, ì´ëŠ” ëª…ì‹œí•˜ê¸° ìœ„í•œ ê²ƒìœ¼ë¡œ ë°˜ë“œì‹œ docker runì˜ ì˜µì…˜ìœ¼ë¡œ í¬íŠ¸
# ë§¤í•‘ì„ í•´ì•¼í•©ë‹ˆë‹¤.

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

- **conf/conf.d/default.conf**

```docker
server {
	listen 80;
    location / {
    	root /usr/share/nginx/html;
        index index.html index.htm;
    }
}
```

docker build -t front .
docker run -it -p 80:80 -d front 

.env íŒŒì¼ì„ ë°›ì•„ì„œ ë£¨íŠ¸ì— ì´ë™

npm buildí•˜ê³  ê·¸ê²Œ dist ë””ë ‰í† ë¦¬ì— ìƒì„±ë˜ê³ 

ê·¸ í´ë”ë“¤ì„ nginx í´ë”ì— ì˜®ê¸°ë©´ ë˜ëŠ”ë°

1. ì§€ê¸ˆ doodê°€ ì œëŒ€ë¡œ ì•ˆë¨..
2. ì–´ë–»ê²Œ ì»¨í…Œì´ë„ˆ ì•ˆì— ë„£ì§€? â‡’ jenkins ì•ˆì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ì–´ì•¼ë˜ëŠ”ê±° ì•„ë‹ê¹Œ? ê·¸ëŸ¬ë©´ ê±°ê¸° ì•ˆì—ì„œ volume mountí•˜ë©´ ë˜ì–ì•„!!

ë‚´ì¼ ë§ˆì € í•´ë³´ì

[https://seongwon.dev/DevOps/20220728-CICDêµ¬ì¶•ê¸°3/](https://seongwon.dev/DevOps/20220728-CICD%EA%B5%AC%EC%B6%95%EA%B8%B03/)

[https://crowdreport-defender.tistory.com/21](https://crowdreport-defender.tistory.com/21)

## âœ¨ë‚´ì¼ ì§„í–‰í•  ë‚´ìš©

- ê°‘ìê¸° doodê°€ ì œëŒ€ë¡œ ì•ˆë¨,â€¦. ì´ê±° í™•ì¸í•´ë´ì•¼

## âœ¨ìë£Œ

### CICD

[240116_CICDì˜ ì •ì˜ì™€ í•„ìš”ì„±.pdf](TIL%20(Today%20I%20Learned)%201fec48ac4832486f99527b3bbe49bc41/240116_CICD%25EC%259D%2598_%25EC%25A0%2595%25EC%259D%2598%25EC%2599%2580_%25ED%2595%2584%25EC%259A%2594%25EC%2584%25B1.pdf)

### SSAFY í¬íŠ¸ ëš«ê¸°â€¦

[ufw í¬íŠ¸ ì„¤ì •í•˜ê¸°.txt](TIL%20(Today%20I%20Learned)%201fec48ac4832486f99527b3bbe49bc41/ufw_%25ED%258F%25AC%25ED%258A%25B8_%25EC%2584%25A4%25EC%25A0%2595%25ED%2595%2598%25EA%25B8%25B0.txt)

```bash
Status: active

     To                         Action      From
     --                         ------      ----
[ 1] 22                         ALLOW IN    Anywhere
[ 2] 8989                       ALLOW IN    Anywhere
[ 3] 443                        ALLOW IN    Anywhere
[ 4] 22 (v6)                    ALLOW IN    Anywhere (v6)
[ 5] 8989 (v6)                  ALLOW IN    Anywhere (v6)
[ 6] 443 (v6)                   ALLOW IN    Anywhere (v6)

ufw status numbered
ufw allow 80

Status: active

     To                         Action      From
     --                         ------      ----
[ 1] 22                         ALLOW IN    Anywhere
[ 2] 8989                       ALLOW IN    Anywhere
[ 3] 443                        ALLOW IN    Anywhere
[ 4] 80                         ALLOW IN    Anywhere
[ 5] 22 (v6)                    ALLOW IN    Anywhere (v6)
[ 6] 8989 (v6)                  ALLOW IN    Anywhere (v6)
[ 7] 443 (v6)                   ALLOW IN    Anywhere (v6)
[ 8] 80 (v6)                    ALLOW IN    Anywhere (v6)

```

## âœ¨ë°°ìš´ ë‚´ìš©

## âœ¨ë¸”ë¡œê·¸ ê¸€ ì‘ì„±

### **[Access Token ì¬ë°œê¸‰ í•˜ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•œ CORS íŠ¸ëŸ¬ë¸” ìŠˆíŒ…](https://velog.io/@damongsanga/Access-Token-%EC%9E%AC%EB%B0%9C%EA%B8%89-%ED%95%98%EB%8A%94-%EA%B3%BC%EC%A0%95%EC%97%90%EC%84%9C-%EB%B0%9C%EC%83%9D%ED%95%9C-CORS-%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85)**

### **[Referer ê²€ì¦ ì¤‘ íŠ¸ëŸ¬ë¸” ìŠˆíŒ… (nginx)](https://velog.io/@damongsanga/Referer-%EA%B2%80%EC%A6%9D-%EC%A4%91-%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85-nginx)**

# ğŸ˜œÂ Todayâ€™s Small Happiness

# ğŸ§Â Letâ€™s Think About It

- ì»¨ì„¤í„´íŠ¸ë‹˜ê»˜ ì—¬ì­¤ë³¼ê¹Œ? í˜„ì¬ ë°© ì¸ì›ìˆœìœ¼ë¡œ ì •ë ¬ í˜ì´ì§•?

# ğŸ™€Â Got Stuck..

- ì˜¤ëŠ˜ ê¹ƒí—™ ì—°ë™í•œë‹µì‹œê³  ê°œë»˜ì§“í•¨ ã…ã…
- ì œë°œ ë‚´ì¼ì€ í¬íŠ¸í´ë¦¬ì˜¤, ì´ë ¥ì„œ ë§ˆë¬´ë¦¬í•˜ì..