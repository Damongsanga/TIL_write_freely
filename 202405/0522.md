# TIL (Today I Learned)

# 5μ›” 22μΌ μμ”μΌ

# πƒΒ What I Learned

## β¨μ¤λ μ§„ν–‰ν• λ‚΄μ©

- [ ]  λ¦¬ν©ν† λ§
    - [x]  μ†λ‚νλΈ λ¦¬ν©ν† λ§
        - [x]  λ¦¬ν©ν† λ§ λΈλμΉ λ”°λ΅ νμ„ κ·Έ λΈλμΉ κΈ°μ¤€μΌλ΅ μ†λ‚νλΈ μƒλ΅ λ§λ“¤μ–΄μ„ λΉ„κµ
        - [x]  coverageλ” 0% (ν…μ¤νΈ μ½”λ“κ°€ μ—†μ..)
    - [x]  λΉ„μ •μƒ μΆ…λ£ νμ¤ν† λ¦¬ λ°ν™ μ•ν•λ„λ΅ μμ •
    - [x]  μ»¤λ°‹ λ©”μ„Έμ§€ λ‚ μ•„λ‹ μ μ € λ°ν™λλ„λ΅
    - [x]  μ°½μ§„ μ½”λ“ μμ •
        - [ ]  μΊμ‹ λ¶€λ¶„ λ” κ³µλ¶€ν•κ³  λ°© μ •λ³΄λ‘ code μ •λ³΄ λ¶„λ¦¬ν•΄μ•Όν• μ§€ νλ‹¨
        - [ ]  @Serviceκ°€ λ§λ”μ§€?
    - [x]  μ»¨νΈλ΅¤λ¬, μ„λΉ„μ¤ λ¶„λ¦¬

## μ†λ‚νλΈ μ •μ  λ¶„μ„

- **κ³Όκ±° 8 bug, 4 security hotspot, 353 code smell**
- **ν„μ¬ 0 bug, 0 security hotspot, 0 code smell**
    - λ¶ν•„μ”ν• importλ¬Έ μ‚­μ , var μ‚¬μ© κ¶κ³  λ“±μ code smellμ€ λ¬΄μ‹ν•μ€μ

### InterrupedException μ²λ¦¬

[http://happinessoncode.com/2017/10/09/java-thread-interrupt/](http://happinessoncode.com/2017/10/09/java-thread-interrupt/)

[Thread.sleepμ—μ„ λ°μƒν• InterrupedException](https://velog.io/@dev_tmb/Thread.sleep%EC%97%90%EC%84%9C-%EB%B0%9C%EC%83%9D%ED%95%9C-InterruptedException) 

[μλ°” μ¤λ λ“ μ΄μ •λ¦¬](https://rebornbb.tistory.com/entry/JAVA-%EB%A9%80%ED%8B%B0%EC%8A%A4%EB%A0%88%EB%93%9C-%EA%B0%9C%EB%85%90)

**InterrupedException : μλ°” μ¤λ λ“μ μΈν„°λ½λ“ λ©”μ»¤λ‹μ¦μ μΌλ¶€**

- ν• μ¤λ λ“κ°€ λ‹¤λ¥Έ μ¤λ λ“λ¥Ό μΈν„°λ½νΈλ„ κ°€λ¥
- κ° μ¤λ λ“λ” μμ‹ μ΄ μΈν„°λ½νΈ λμ—λ”μ§€ ν™•μΈ κ°€λ¥

**`InterruptedException`μ€ μ¤λ λ“κ°€ λ€κΈ° μƒνƒμ— μμ„ λ•(μ: `sleep`, `wait` λ“±) β€λ‹¤λ¥Έ μ¤λ λ“β€κ°€ κ·Έ μ¤λ λ“λ¥Ό μΈν„°λ½νΈν•λ©΄ λ°μƒ**

**`Thread.sleep()`μ΄ ν•­μƒ `InterruptedException`μ„ λ°μƒμ‹ν‚¤λ” κ²ƒμ€ μ•„λ‹λ©°, μ΄ μμ™Έλ” λ‹¤λ¥Έ μ¤λ λ“κ°€ ν„μ¬ μ¤λ λ“λ¥Ό μΈν„°λ½νΈν–μ„ λ•λ§ λ°μƒν•©λ‹λ‹¤.** 

- ν„μ¬ μ¤λ λ“κ°€ λ€μƒ μ¤λ λ“λ¥Ό μμ •ν•  μ μλ” κ¶ν•μ΄ μ—†μΌλ©΄Β [SecurityException](https://docs.oracle.com/javase/8/docs/api/java/lang/SecurityException.html)μ΄ λ°μƒν•λ‹¤.
- λ€μƒ μ¤λ λ“κ°€Β `Object.wait()`,Β `Thread.sleep()`,Β `Thread.join()`,Β `Future.get(), BlockingQueue.take()`Β λ“±μ λ©”μ„λ“μ— μν•΄ λΈ”λ΅ν‚Ήλ κ²½μ°,Β **interrupt stateκ°€ μ‚¬λΌμ§€κ³ **Β `InterruptedException`μ΄ λ°μƒν•λ‹¤.
- λ€μƒ μ¤λ λ“κ°€Β [InterruptibleChannel](https://docs.oracle.com/javase/8/docs/api/java/nio/channels/InterruptibleChannel.html)μ„ μ΄μ©ν• I/O μ‘μ—…μ— μν•΄ λΈ”λ΅ν‚Ήλ κ²½μ°,Β **interrupt stateκ°€ μ„¤μ •λκ³ **Β [ClosedByInterruptException](https://docs.oracle.com/javase/8/docs/api/java/nio/channels/ClosedByInterruptException.html)μ΄ λ°μƒν•λ‹¤.
- λ€μƒ μ¤λ λ“κ°€Β [Selector](https://docs.oracle.com/javase/8/docs/api/java/nio/channels/Selector.html)μ—μ„ λΈ”λ΅ν‚Ήλ κ²½μ°,Β **interrupt stateκ°€ μ„¤μ •λκ³ **Β selection μ‘μ—…μ—μ„ λ¦¬ν„΄λλ‹¤.
- μ΄μ™Έμ κ²½μ°μ—λ”Β **interrupt stateκ°€ μ„¤μ •λλ‹¤.**

Β **interrupt state ν™•μΈν•λ” λ²•**

1. interrupt stateκ°€ μ„¤μ •λμ—λ”μ§€ ν™•μΈ
2. `InterruptedException`μ΄ λ°μƒν–λ”μ§€ ν™•μΈ

**μΈν„°λ½νΈκ°€ λ¬΄μ‹λλ©΄?**

μΈν„°λ½νΈλ¥Ό λ¬΄μ‹ν•λ©΄ μ—¬λ¬ κ°€μ§€ λ¶€μ •μ μΈ κ²°κ³Όκ°€ λ°μƒν•  μ μμµλ‹λ‹¤. 

1. **λ¦¬μ†μ¤ λ„μ**: μΈν„°λ½νΈλ¥Ό λ¬΄μ‹ν•λ©΄ μ¤λ λ“κ°€ μ •μƒμ μΌλ΅ μΆ…λ£λμ§€ μ•κ³  κ³„μ† μ‹¤ν–‰λ  μ μμµλ‹λ‹¤. μ΄λ” λ©”λ¨λ¦¬λ‚ νμΌ ν•Έλ“¤, λ„¤νΈμ›ν¬ μ—°κ²°κ³Ό κ°™μ€ μμ›μ΄ ν•΄μ λμ§€ μ•κ³  λ‚¨μ•„μλ” μƒν™©μ„ μ΄λν•  μ μμµλ‹λ‹¤.
2. **ν”„λ΅κ·Έλ¨ μ •μ§€**: μΈν„°λ½νΈλ¥Ό λ¬΄μ‹ν•λ©΄ ν”„λ΅κ·Έλ¨μ΄ νΉμ • μ‘μ—…μ—μ„ λ©μ¶”λ” μƒν™©μ΄ λ°μƒν•  μ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ¤λ λ“κ°€ λ¬΄κΈ°ν• λ€κΈ° μƒνƒμ— λΉ μ§ μ μμµλ‹λ‹¤.
3. **μ‘λ‹µ λ¶κ°€ μƒνƒ**: μ‚¬μ©μ μΈν„°νμ΄μ¤(UI) μ¤λ λ“κ°€ μΈν„°λ½νΈλ¥Ό λ¬΄μ‹ν•λ©΄ λ²„νΌ ν΄λ¦­μ΄λ‚ λ‹¤λ¥Έ μ‚¬μ©μ μΈν„°λ™μ…μ— λ°μ‘ν•μ§€ μ•λ” μƒνƒκ°€ λ  μ μμµλ‹λ‹¤.
4. **μ •ν™•ν•μ§€ μ•μ€ μƒνƒ**: μΈν„°λ½νΈλ¥Ό λ¬΄μ‹ν•λ©΄ ν”„λ΅κ·Έλ¨μ λ…Όλ¦¬μ  νλ¦„μ΄ κΉ¨μ§ μ μμµλ‹λ‹¤. μ΄λ” λ°μ΄ν„°μ λ¶μΌμΉλ‚ μκΈ°μΉ μ•μ€ λ™μ‘μ„ μ λ°ν•  μ μμµλ‹λ‹¤.
5. **μκΈ°μΉ μ•μ€ λ™μ‘**: μΈν„°λ½νΈλ¥Ό λ¬΄μ‹ν•λ©΄ μ‘μ—…μ΄ μ •μƒμ μΌλ΅ μ™„λ£λμ§€ μ•κ±°λ‚, μκΈ°μΉ μ•μ€ μμ™Έκ°€ λ°μƒν•  μ μμµλ‹λ‹¤. μ΄λ” ν”„λ΅κ·Έλ¨μ μ‹ λΆ°μ„±μ„ λ–¨μ–΄λ¨λ¦½λ‹λ‹¤.

λ”°λΌμ„ `InterruptedException`μ„ μ΅μ•μ„ λ•λ” μ΄λ¥Ό μ μ ν μ²λ¦¬ν•μ—¬ μ¤λ λ“κ°€ μ •μƒμ μΌλ΅ μΆ…λ£λκ±°λ‚, ν•„μ”ν• κ²½μ° λ‹¤μ‹ μΈν„°λ½νΈ μƒνƒλ¥Ό μ„¤μ •(`Thread.currentThread().interrupt()`)ν•μ—¬ μƒμ„ λ©”μ„λ“κ°€ μ΄λ¥Ό μ²λ¦¬ν•  μ μλ„λ΅ ν•΄μ•Ό ν•©λ‹λ‹¤.

**μΈν„°λ½νΈ μƒνƒλ€? μ™ μ΄λ¥Ό μ„¤μ •ν•΄μ£Όλ” κ²ƒμ΄ μ¤‘μ”ν•κ°€?**

μΈν„°λ½νΈ μƒνƒ(interrupt status)λ” μ¤λ λ“(Thread)κ°€ μΈν„°λ½νΈ(interrupt) μ”μ²­μ„ λ°›μ•λ”μ§€ μ—¬λ¶€λ¥Ό λ‚νƒ€λ‚΄λ” ν‘μ‹μ…λ‹λ‹¤. μλ°”(Java)μ—μ„λ” μ¤λ λ“μ— λ€ν•΄ `interrupt()` λ©”μ„λ“λ¥Ό νΈμ¶ν•μ—¬ ν•΄λ‹Ή μ¤λ λ“λ¥Ό μΈν„°λ½νΈν•  μ μμµλ‹λ‹¤. μ΄λ• ν•΄λ‹Ή μ¤λ λ“μ μΈν„°λ½νΈ μƒνƒκ°€ μ„¤μ •λ©λ‹λ‹¤.

μΈν„°λ½νΈλ” λ‹¤μ–‘ν• μ΄μ λ΅ μ‚¬μ©λ  μ μμ§€λ§, μ£Όλ΅ μ¥μ‹κ°„ μ‹¤ν–‰λλ” μ‘μ—…μ„ μ¤‘λ‹¨ν•κ±°λ‚ λ€κΈ° μƒνƒμ— μλ” μ¤λ λ“λ¥Ό κΉ¨μ°λ” λ° μ‚¬μ©λ©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ‚¬μ©μκ°€ μ‘μ—…μ„ μ·¨μ†ν•κΈΈ μ›ν•  λ•, λλ” μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μΆ…λ£λ  λ• μ‹¤ν–‰ μ¤‘μΈ μ¤λ λ“λ¥Ό μ•μ „ν•κ² μΆ…λ£ν•κΈ° μ„ν•΄ μΈν„°λ½νΈκ°€ μ‚¬μ©λ  μ μμµλ‹λ‹¤.

ν•μ§€λ§, `InterruptedException`μ΄ λ°μƒν•  κ²½μ°, ν•΄λ‹Ή μ¤λ λ“μ μΈν„°λ½νΈ μƒνƒλ” μλ™μΌλ΅ μ΄κΈ°ν™”(μ¦‰, μΈν„°λ½νΈ μƒνƒκ°€ falseλ΅ μ„¤μ •)λλ―€λ΅, μΈν„°λ½νΈλ¥Ό λ…μ‹μ μΌλ΅ λ‹¤μ‹ μ„¤μ •ν•΄μ•Ό ν•λ” κ²½μ°κ°€ μμµλ‹λ‹¤. μ΄λ” `Thread.currentThread().interrupt()`λ¥Ό νΈμ¶ν•μ—¬ μν–‰ν•  μ μμµλ‹λ‹¤.

μ΄λ¬ν• μ²λ¦¬κ°€ ν•„μ”ν• μ΄μ λ” μƒμ„ λ©”μ„λ“λ‚ λ‹¤λ¥Έ μ»΄ν¬λ„νΈμ—μ„ ν•΄λ‹Ή μ¤λ λ“κ°€ μΈν„°λ½νΈλμ—λ”μ§€ μ—¬λ¶€λ¥Ό ν™•μΈν•κ³ , μ μ ν λ€μ‘ν•  μ μλ„λ΅ ν•κΈ° μ„ν•¨μ…λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μΈν„°λ½νΈ μƒνƒλ¥Ό ν™•μΈν•μ—¬ μ¶”κ°€μ μΈ μ •λ¦¬ μ‘μ—…μ„ μν–‰ν•κ±°λ‚, μ‚¬μ©μμ—κ² μ‘μ—…μ΄ μ¤‘λ‹¨λμ—μμ„ μ•λ¦΄ μ μμµλ‹λ‹¤.

κ°„λ‹¨ν λ§ν•΄μ„, `InterruptedException`μ„ μ²λ¦¬ν• ν›„μ— μΈν„°λ½νΈ μƒνƒλ¥Ό λ…μ‹μ μΌλ΅ λ‹¤μ‹ μ„¤μ •ν•λ” κ²ƒμ€ λ‹¤λ¥Έ λ©”μ„λ“λ‚ μ¤λ λ“κ°€ μΈν„°λ½νΈ μ”μ²­μ„ μΈμ§€ν•κ³  κ·Έμ— λ”°λΌ μ μ ν λ€μ‘ν•  μ μλ„λ΅ ν•κΈ° μ„ν• κ²ƒμ…λ‹λ‹¤. μ΄λ” ν”„λ΅κ·Έλ¨μ μ•μ •μ„±κ³Ό μμΈ΅ κ°€λ¥μ„±μ„ μ μ§€ν•λ” λ° μ¤‘μ”ν• μ—­ν• μ„ ν•©λ‹λ‹¤.

```java
try {
    Thread.sleep(waitTime);
} catch (InterruptedException e) {
		log.error("interrupted Exception", e);
    Thread.currentThread().interrupt(); // μΈν„°λ½νΈ stateλ¥Ό μ„¤μ •ν•΄μ£Όμ–΄μ•Ό
    throw new RestApiException(INTERNAL_SERVER_ERROR);
}
```

`InterruptedExceptions`Β should never be ignored in the code, and simply logging the exception counts in this case as "ignoring". The throwing of theΒ `InterruptedException`Β clears the interrupted state of the Thread, so if the exception is not handled properly the fact that the thread was interrupted will be lost. **Instead,Β `InterruptedExceptions`Β should either be rethrown - immediately or after cleaning up the method's state - or the thread should be re-interrupted by callingΒ `Thread.interrupt()`Β even if this is supposed to be a single-threaded application.** Any other course of action risks delaying thread shutdown and loses the information that the thread was interrupted - probably without finishing its task.

**μ™ stateλ¥Ό λ‹¤μ‹ μ„¤μ •ν•λ”κ°€?**

**μΈν„°λ½νΈλ¥Ό μ‹λ„ν–μΌλ©΄, λκΉμ§€ μΈν„°λ½νΈλ¥Ό μν–‰ν•λ„λ΅!** 

**β†’ InterruptExceptionμ΄ λ°μƒν–λ‹¤λ” κ²ƒμ€ μƒνƒκ°€ interruptλ΅ μΈμ‹λλ” λ° μ‹¤ν¨ν–μμ„ μλ―Έν•λ―€λ΅ μλ™μΌλ΅ μƒνƒλ¥Ό λ°”κΏ”μ£Όκ³  μ‘μ—…μ΄ μΆ…λ£λλ„λ΅ ν•΄μ•Ό ν•λ‹¤.**

`InterruptedException`μ΄ λ°μƒν•  λ•λ” μ¤λ λ“μ interrupt stateκ°€ μ„¤μ •λμ§€ μ•λ”λ‹¤. λ”°λΌμ„ μμ™Έ μ²λ¦¬λ¬Έμ—μ„ μ§μ ‘ interrupt stateλ¥Ό μ„¤μ •ν•μ—¬ μ‘μ—…μ΄ μΆ…λ£λκ² ν•΄μ•Όν•λ‹¤.

**μ¤λ λ“λ¥Ό κ΄€λ¦¬ν•λ” μƒμ„ λ μ΄μ–΄(μ—¬κΈ°μ„λ” μ¤λ λ“ν’€)μ— μΈν„°λ½νΈ λ°μƒ μ—¬λ¶€λ¥Ό μ•λ¦΄ μ μ—†κ² λλ‹¤. μ¤λ λ“ν’€ μ—­μ‹ λ°μƒν• μΈν„°λ½νΈλ¥Ό μ μ ν μ²λ¦¬ν•  μ μλ„λ΅ interrupt stateλ¥Ό μ„¤μ •ν•΄μ•Ό ν•λ‹¤.**

μ§€κΈκΉμ§€λ” μ¤λ λ“ ν’€μ—μ„μ κ²½μ°μ€λ‹¤.

κ·Έλ ‡λ‹¤λ©΄ μ¤λ λ“ ν’€μ΄ μ•„λ‹ μ¤λ λ“λ¥Ό μ§μ ‘ λ§λ“¤μ–΄μ„ μ„¤μ •ν•λ‹¤λ©΄??

ν•΄λ‹Ή μ¤λ λ“λ¥Ό μ§μ ‘ μ°Έμ΅°ν•  μ μμμΌλ΅ μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•  λ• μ¤λ λ“λ¥Ό κ΄€λ¦¬ν•λ” μƒμ„ λ μ΄μ–΄μ— μΈν„°λ½νΈ μƒνƒλ¥Ό μ•λ¦΄ ν•„μ”κ°€ μ—†λ‹¤.

**ν•μ§€λ§, μµκ΄€μ²λΌ μΈν„°λ½νΈ stateλ¥Ό μ„¤μ •ν•λ” κ²ƒμ€ μΆ‹μ€ μµκ΄€μ΄λ‹¤!**

```java
try {
    Thread.sleep(waitTime);
} catch (InterruptedException e) {
    this.interrupt();
}
```

## β¨λ‚΄μΌ μ§„ν–‰ν•  λ‚΄μ©

- [ ]  [μ΄λ² ν”„λ΅μ νΈ νκ³  μ‘μ„±](https://www.notion.so/URTurn-72193c1a7d5b4c78a4798e9469469594?pvs=21)
- [ ]  ν¬νΈν΄λ¦¬μ¤ μ‘μ„±
    - [ ]  urturn
    - [ ]  flowermari

- [ ]  λ¦¬ν©ν† λ§
    - [x]  μ°½μ§„ μ½”λ“ μμ •
        - [ ]  μΊμ‹ λ¶€λ¶„ λ” κ³µλ¶€ν•κ³  λ°© μ •λ³΄λ‘ code μ •λ³΄ λ¶„λ¦¬ν•΄μ•Όν• μ§€ νλ‹¨
        - [ ]  @Serviceκ°€ λ§λ”μ§€?
        - [ ]  
    - [ ]  μ‚¬μ©μ κ¶ν• κΉκ² νλ³΄κΈ°
    - [ ]  [μ–΄λ–»κ² λ™μ‹ μ¤‘λ³µ μ”μ²­μ„ μ²λ¦¬ν•  μ μμ„κΉ?](https://okky.kr/articles/1420164)
    - [ ]  κ·ΈλΌνλ‚ λ¨λ‹ν„°λ§ λ°μ΄ν„° λ‚΄μ© ν™•μΈν•΄λ³΄κΈ°
    - [ ]  μ±„μ  μ„λ²„ λ¨λ‹ν„°λ§ ν™•λ€
    - [ ]  redis
        - [ ]  redis cache μ‚¬μ©λ²• & μ›λ¦¬
        - [ ]  λ λ””μ¤μ— ν„μ¬ μ μ € λ“¤μ–΄μλ” λ°© ν™•μΈ λ΅μ§ μ¶”κ°€

- [ ]  κ³µλ¶€
    - [ ]  μ›Ήμ†μΌ“ ~ μ™Έλ¶€ λ©”μ„Έμ§€ λΈλ΅μ»¤

- μ—¬κΈ°μ— cacheputμ„ λ„£μ€ μ΄μ  λ¬Όμ–΄λ³΄κΈ°

```bash
    @CachePut(value = "responseCache", key = "#roomId + '_' + #questionId")
    public List<UserCodeDto> updateCodeCache(String roomId, String questionId, UserCodeDto newCode) {
        List<UserCodeDto> currentCodes = cachedatas.cacheCodes(roomId, questionId);
        if (currentCodes == null) {
            currentCodes = new ArrayList<>();
        }
        log.info("ν„μ¬ μ½”λ“ μ‚¬μ΄μ¦ = {}", currentCodes.size());
        if(newCode!=null){
            currentCodes.add(newCode);
        }

        cachedatas.cacheCodes(roomId, questionId, currentCodes);

        return currentCodes;
    }
```

# πΒ Todayβ€™s Small Happiness

# π§Β Letβ€™s Think About It

# π™€Β Got Stuck..