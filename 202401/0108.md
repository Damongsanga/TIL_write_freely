# TIL (Today I Learned)

# 1ì›” 8ì¼ ì›”ìš”ì¼

# ğŸ˜ƒÂ What I Learned

## í”„ë¡œì íŠ¸ 1ì¼ì°¨

- ì•„ì´ë””ì–´ ì¶”ê°€ ì •ë¦¬ ë° ì„ ì •
- ì»¨ë²¤ì…˜ ì„¤ì •
- ì£¼ ê¸°ëŠ¥ / ì¶”ê°€ ê¸°ëŠ¥ êµ¬ë¶„ ë° ì„¤ì • ì™„ë£Œ

## Reactor (í˜¼ì ê³µë¶€)

- flatMap

```java
@Test
void contextLoads() {
    List<ThreadStringClass> list = method().collectList().block();
    list.forEach(System.out::println);
}

public Flux<ThreadStringClass> method(){
    return Flux.just("a", "b", "c", "d", "e", "f", "g", "h", "i") // Flux<String>
            .window(3) //Flux<Flux<String>>
            .flatMap(l -> l.map(this::toUpperCase).subscribeOn(Schedulers.parallel())) // Flux<ThreadStringClass>
            .log()
            .doOnNext(this::doubleString)
            .log();
}

// ThreadStringClassëŠ” ê°’ì„ ë‹´ëŠ” strì™€ ì“°ë ˆë“œ ì´ë¦„ì„ ë‹´ëŠ” threadNameìœ¼ë¡œ ì´ë¤„ì§„ í´ë˜ìŠ¤
private ThreadStringClass toUpperCase(String s) {
    try {
        Thread.sleep(1000);
    } catch (InterruptedException e){
        e.printStackTrace();
    }
    return new ThreadStringClass(s.toUpperCase(), Thread.currentThread().getName());
}

private void doubleString(ThreadStringClass tsc) {
    String tmp = tsc.getStr();
    tsc.setStr(tmp + tmp);
}
```

```java
2024-01-08T13:16:31.342+09:00  INFO 8344 --- [    Test worker] test.test.TestApplicationTests           : Starting TestApplicationTests using Java 17.0.9 with PID 8344 (started by SSAFY in C:\Users\SSAFY\Downloads\test)
2024-01-08T13:16:31.344+09:00  INFO 8344 --- [    Test worker] test.test.TestApplicationTests           : No active profile set, falling back to 1 default profile: "default"
2024-01-08T13:16:32.512+09:00  INFO 8344 --- [    Test worker] test.test.TestApplicationTests           : Started TestApplicationTests in 1.352 seconds (process running for 2.472)
2024-01-08T13:16:33.201+09:00  INFO 8344 --- [    Test worker] reactor.Flux.FlatMap.1                   : onSubscribe(FluxFlatMap.FlatMapMain)
2024-01-08T13:16:33.202+09:00  INFO 8344 --- [    Test worker] reactor.Flux.Peek.2                      : onSubscribe(FluxPeek.PeekSubscriber)
2024-01-08T13:16:33.203+09:00  INFO 8344 --- [    Test worker] reactor.Flux.Peek.2                      : request(unbounded)
2024-01-08T13:16:33.203+09:00  INFO 8344 --- [    Test worker] reactor.Flux.FlatMap.1                   : request(unbounded)
2024-01-08T13:16:34.234+09:00  INFO 8344 --- [     parallel-3] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='G', threadName='parallel-3'})
2024-01-08T13:16:34.235+09:00  INFO 8344 --- [     parallel-3] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='GG', threadName='parallel-3'})
2024-01-08T13:16:34.235+09:00  INFO 8344 --- [     parallel-3] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='A', threadName='parallel-1'})
2024-01-08T13:16:34.235+09:00  INFO 8344 --- [     parallel-3] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='AA', threadName='parallel-1'})
2024-01-08T13:16:34.235+09:00  INFO 8344 --- [     parallel-3] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='D', threadName='parallel-2'})
2024-01-08T13:16:34.235+09:00  INFO 8344 --- [     parallel-3] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='DD', threadName='parallel-2'})
2024-01-08T13:16:35.239+09:00  INFO 8344 --- [     parallel-2] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='E', threadName='parallel-2'})
2024-01-08T13:16:35.239+09:00  INFO 8344 --- [     parallel-2] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='EE', threadName='parallel-2'})
2024-01-08T13:16:35.239+09:00  INFO 8344 --- [     parallel-2] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='B', threadName='parallel-1'})
2024-01-08T13:16:35.239+09:00  INFO 8344 --- [     parallel-2] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='BB', threadName='parallel-1'})
2024-01-08T13:16:35.240+09:00  INFO 8344 --- [     parallel-2] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='H', threadName='parallel-3'})
2024-01-08T13:16:35.240+09:00  INFO 8344 --- [     parallel-2] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='HH', threadName='parallel-3'})
2024-01-08T13:16:36.245+09:00  INFO 8344 --- [     parallel-1] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='C', threadName='parallel-1'})
2024-01-08T13:16:36.245+09:00  INFO 8344 --- [     parallel-1] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='CC', threadName='parallel-1'})
2024-01-08T13:16:36.245+09:00  INFO 8344 --- [     parallel-1] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='F', threadName='parallel-2'})
2024-01-08T13:16:36.245+09:00  INFO 8344 --- [     parallel-1] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='FF', threadName='parallel-2'})
2024-01-08T13:16:36.245+09:00  INFO 8344 --- [     parallel-1] reactor.Flux.FlatMap.1                   : onNext(ThreadStringClass{str='I', threadName='parallel-3'})
2024-01-08T13:16:36.246+09:00  INFO 8344 --- [     parallel-1] reactor.Flux.Peek.2                      : onNext(ThreadStringClass{str='II', threadName='parallel-3'})
2024-01-08T13:16:36.246+09:00  INFO 8344 --- [     parallel-1] reactor.Flux.FlatMap.1                   : onComplete()
2024-01-08T13:16:36.246+09:00  INFO 8344 --- [     parallel-1] reactor.Flux.Peek.2                      : onComplete()
ThreadStringClass{str='GG', threadName='parallel-3'}
ThreadStringClass{str='AA', threadName='parallel-1'}
ThreadStringClass{str='DD', threadName='parallel-2'}
ThreadStringClass{str='EE', threadName='parallel-2'}
ThreadStringClass{str='BB', threadName='parallel-1'}
ThreadStringClass{str='HH', threadName='parallel-3'}
ThreadStringClass{str='CC', threadName='parallel-1'}
ThreadStringClass{str='FF', threadName='parallel-2'}
ThreadStringClass{str='II', threadName='parallel-3'}
```

- ì•„ë˜ì²˜ëŸ¼ doOnNextì— Monoë¥¼ ë¦¬í„´í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ë„ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤. ì™œì§€?
    - doOnNextëŠ” side effectë¥¼ ìœ„í•œ ë©”ì†Œë“œì„ì„ ëª…ì‹¬í•˜ì

```java
public Flux<ThreadStringClass> method(){
    return Flux.just("a", "b", "c", "d", "e", "f", "g", "h", "i") // Flux<String>
            .window(3) //Flux<Flux<String>>
            .flatMap(l -> l.map(this::toUpperCase).subscribeOn(Schedulers.parallel())) // Flux<ThreadStringClass>
            .log()
            .doOnNext(this::doubleStringMono)
            .log();
}

private Mono<ThreadStringClass> doubleStringMono(ThreadStringClass tsc) {
        String tmp = tsc.getStr();
        tsc.setStr(tmp + tmp);
        return Mono.just(tsc);
    }
```

# ğŸ˜œÂ Todayâ€™s Small Happiness

- 

# ğŸ§Â Letâ€™s Think About It

- 

# ğŸ™€Â Got Stuck..

- í”„ë¡œì íŠ¸ ì§„ì§œ ê¸°ë¹¨ë¦°ë‹¤.. ìš´ë™ë„ ì—´ì‹¬íˆí•˜ê³  ì²´ë ¥ê´€ë¦¬ë„ ì˜ í•´ì•¼ê² ë‹¤â€¦