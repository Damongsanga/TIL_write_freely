# TIL (Today I Learned)

# 1ì›” 17ì¼ ìˆ˜ìš”ì¼

# ğŸ˜ƒÂ What I Learned

## í”„ë¡œì íŠ¸ 8ì¼ì°¨

### ì§„í–‰ ë‚´ìš©

- í…ŒìŠ¤íŠ¸ dbìš© h2 ë”°ë¡œ ì„¤ì •
- ë°© CRUD
- Enum ê¸°ì¤€ í†µì¼
- validation ê¸°ì¤€ ì„¤ì • ë° ì¡°ê±´ ì„¤ì •
- querydslì„ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰
- Roomì— managerë¥¼ Memberë¡œ í•´ì•¼í•˜ëŠ”ê°€, managerIdë§Œ ì €ì¥í•´ì•¼í•˜ëŠ”ê°€?
    - Memberë¡œ í•´ë„ ëœë‹¤. í”„ë¡ì‹œì˜ pkë¥¼ ì¡°íšŒí•  ë•ŒëŠ” ì´ˆê¸°í™”í•˜ì§€ ì•Šê¸° ë•Œë¬¸

### ì§„í–‰ì¤‘

- querydsl í˜ì´ì§€ë„¤ì´ì…˜ ì§„í–‰ í•„ìš”

### ë‚´ì¼ ì§„í–‰í•´ì•¼ í•  ê²ƒ

- Room - Channel/Lounge ì–‘ë°©í–¥ ë§¤í•‘ì´ í•„ìš”í•œì§€ ê³ ë¯¼
- fetch join ì¨ì•¼í•˜ëŠ”ì§€? â‡’ í˜ì´ì§• ë¬¸ì œë°œìƒ ì—¬ë¶€ ë‹¤ì‹œ í™•ì¸

## ì˜¤ëŠ˜ ë§‰íŒ ë¶€ë¶„

## í•´ê²°í•œ ë¶€ë¶„

- Enum + `@Enumerated(EnumType.*STRING*)`
    - ENUM ì´ë¦„ì´ë‘ ë˜‘ê°™ì€ String ê°’ìœ¼ë¡œ ì €ì¥ëœë‹¤
    - Entityì—ë§Œ ë„£ìœ¼ë©´ ë  ê²ƒì´ë‹¤!
    - DTOì—ëŠ” ì €ì¥í•  ê²ƒì´ ì•„ë‹ˆë‹ˆ ë„£ì„ í•„ìš”ê°€ ì—†ë‹¤

- validation

```java
@Getter
@Validated
public class RoomCreateRequestDto {

    @Setter
    private String mangerId;
    @NotNull
    private String title;
    private String description;
    @Min(1)
    private int capacity;
    private RoomConstraints constraints;
    private RoomType type;
}
```

- @Rollback(false)ëŠ” í´ë˜ìŠ¤ ë‹¨ìœ„ê°€ ì•„ë‹Œ ë©”ì„œë“œì— ì‚¬ìš©í•˜ì

## QueryDsl

- **whereì— nullì´ ìˆë‹¤ë©´ ê·¸ëƒ¥ ìŠ¤í‚µí•œë‹¤**

### **queryDsl BooleanBuilderë¥¼ í™œìš©í•œ ì¡°ê±´ ìƒì„±**

- between
- andAnyOf

```java
//ê°œì„  ì „
BooleanBuilder keywordBuilder = new BooleanBuilder();
if (req.getSearchKeyword() != null) {
          builder.andAnyOf(
          room.title.contains(req.getSearchKeyword()),
          room.description.contains(req.getSearchKeyword()
		  );
}
builder.and(keywordBuilder);
```

```java
//ê°œì„  í›„
if (req.getSearchKeyword() != null) {
        keywordBuilder.or(room.title.contains(req.getSearchKeyword()));
        keywordBuilder.or(room.description.contains(req.getSearchKeyword()));
 }
```

## ê³µë¶€í•˜ë‹¤ ì•ˆ ê²ƒë“¤

### `í”„ë¡ì‹œ ê°ì²´ì˜ pkë¡œ ì ‘ê·¼í•  ë•Œ, í”„ë¡ì‹œ ê°ì²´ëŠ” ì´ˆê¸°í™”ë˜ì§€ ì•ŠëŠ”ë‹¤`

[https://yarisong.tistory.com/31](https://yarisong.tistory.com/31)

```java
@Test
    @DisplayName("í”„ë¡ì‹œ ê°ì²´ì˜ pkë¡œ ì ‘ê·¼í•  ë•Œ, í”„ë¡ì‹œ ê°ì²´ëŠ” ì´ˆê¸°í™”ë˜ì§€ ì•ŠëŠ”ë‹¤")
    void proxyPkTest() {
        //given
        // Manager ë©¤ë²„ ìƒì„±
        Member manager = Member.builder().memberId("ë©¤ë²„1").build();
        em.persist(manager);
        em.flush();
        em.clear();

        log.info("ë©¤ë²„ ìƒì„±");

        //ë°© ìƒì„±
        RoomCreateRequestDto reqR = RoomCreateRequestDto.builder().
                mangerId("ë©¤ë²„1").
                title("title").description("ì„¤ëª…").capacity(10).constraints(RoomConstraints.FREE).type(RoomType.PERMANENT).
                build();
        Room newRoom = roomService.createRoom(reqR);

        log.info("ë°© ìƒì„±");

        Room newRoom2 = roomRepository.findById(newRoom.getId()).get();

        log.info("ë§¤ë‹ˆì € ì´ë¦„ : {}", newRoom2.getManager().getMemberId());
    }
```

## ê³µë¶€ë‚´ìš©

- Spring Security ì§„í–‰ì¤‘

# ğŸ˜œÂ Todayâ€™s Small Happiness

- ì˜¤ëŠ˜ì€ ì§‘ì—ì„œ ì‹œíë¦¬í‹° ì¡°ê¸ˆë§Œ ë³´ê³  ì  ë„ˆë¬´ ì¡¸ë¦¬ë‹¤ì•„
- ìš´ë™ì€ í–ˆë‹¤

# ğŸ§Â Letâ€™s Think About It

- í˜ì´ì§•ì„ ì–´ë–»ê²Œ í• ì§€ ë‚´ì¼ ì˜¤ì „ë™ì•ˆ ê³ ë¯¼í•´ë³´ì
- ì˜¤í›„ì—ëŠ” ì±„ë„ê³¼ ë¼ìš´ì§€ CRUDë¥¼ ë§ˆë¬´ë¦¬í•˜ì

# ğŸ™€Â Got Stuck..