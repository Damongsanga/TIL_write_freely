# TIL (Today I Learned)

# 11ì›” 22ì¼ ìˆ˜ìš”ì¼

# ğŸ˜ƒÂ What I Learned

# ì¿ í‚¤ CORS ë¬¸ì œ

[ğŸŒ ì•…ëª… ë†’ì€ CORS ê°œë… & í•´ê²°ë²• - ì •ë¦¬ ëíŒì™• ğŸ‘](https://inpa.tistory.com/entry/WEB-ğŸ“š-CORS-ğŸ’¯-ì •ë¦¬-í•´ê²°-ë°©ë²•-ğŸ‘)

### Spring WebConfig CORS ê¶Œí•œ ë¶€ì—¬

- allowCredentials(true) ì„¤ì • í•„ìš”

```java
@Override
	public void addCorsMappings(CorsRegistry registry) {
		registry.addMapping("/**").allowedOrigins("https://solved.ac/api/v3", "http://localhost:5173")
				.allowedMethods("GET", "POST").allowCredentials(true); // allowCredentials : ì¿ í‚¤ ì¸ì¦ ìš”ì²­ í—ˆìš©
	}
```

### Vue cooke ë„£ì–´ì„œ axios ìš”ì²­

- axios ìš”ì²­ì— cookie ë„£ê¸°
- withCredentials: true ì„¤ì • í•„ìš”
- headerì— ì¿ í‚¤ ë„£ì–´ì•¼

```jsx
const id = 4; // ì•„ì´ë”” ì„¤ì •í•  ê²ƒ
        axios({
          url: `http://localhost:8080/api/main/group/${id}`,
          method: "GET",
          withCredentials: true, // ì´ê±° ì„¤ì •í•´ì¤˜ì•¼ ì¿ í‚¤ unsafe ë¬´ì‹œí•˜ê³  ë„£ì„ ìˆ˜ ìˆìŒ
          headers: {
            Cookie: getCookie("mySessionId")
          }, 
        }).then()
...
```

- getCookie Method

```java
const getCookie = (key) => {
      var result = null;
      var cookie = document.cookie.split(";");
      cookie.some(function (item) {
        item = item.replace("Â ", "");
        var dic = item.split("=");
        if (key === dic[0]) {
          result = dic[1];
          return true;
        }
      });
      return result;
    };
```

- vueì—ì„œ ì¿ í‚¤ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ë”°ë¡œ ìˆì§€ë§Œ ë­”ê°€ ì‘ë™ì´ ì•ˆë¨..
- ì–´ë ¤ìš´ ê²ƒ ê°™ì§€ëŠ” ì•Šìœ¼ë‹ˆ ë‚˜ì¤‘ì— ì‹œë„í•´ë³´ì

[vue-cookies ì‚¬ìš©ë²•](https://kyounghwan01.github.io/blog/Vue/vue/vue-cookies/)

# ì¸ì¤„ ì•Œì•˜ëŠ”ë°..

ì´ê±° êµ³ì´ ì•ˆí•´ë„ ì¿ í‚¤ë¥¼ ì•Œì•„ì„œ ë„£ì–´ì¤€ë‹¤.. ë§¤ìš° ì–´ì´ì—†ë‹¤â€¦

```jsx
          headers: {
            Cookie: getCookie("mySessionId")
          }, 
```

# Mono, Flux ë¬¸ì œ

- Mono fromCallable, defer
    - fromCallable : `fetchOneQueryDataMono` ì—ì„œ Mono<JsonNode>ê°€ ë¦¬í„´ë˜ì–´ Mono<Mono<JsonNode>>ë¥¼ ë¦¬í„´í•˜ê²Œ ë˜ëŠ” ë¬¸ì œ
    - defer : ì¤‘ë³µ Monoê°€ ìƒì„±ë˜ëŠ”ê²ƒì„ ë§‰ì•„ì¤Œ
- Voidë¥¼ ë¦¬í„´í•˜ì§€ ë§ê³  Monoë‚˜ Fluxë¥¼ ë¦¬í„´í•˜ëŠ” í˜•íƒœë¡œ ì½”ë“œë¥¼ êµ¬í˜„í•´ì•¼í•œë‹¤

```java
public Mono<Void> userAddTask(String userName) {
    return processUser(userName)
            .then();
}

@Transactional
private Mono<Void> processUser(String userName) {
    return fetchUser(userName)
            .flatMap(user -> {
                Mono<Void> insertUserMono = insertUser(user);
                Mono<Void> fetchProblemsMono = fetchProblems(user);
                Mono<Void> fetchUserTierMono = fetchUserTier(user);

                // processUserTierê°€ ì™„ë£Œëœ í›„ì— processUserTierProblem ì‹¤í–‰
                return fetchProblemsMono
                        .then(fetchUserTierMono)
                        .then(Mono.defer(() -> fetchUserTierProblem(user)));
            });
}

private Mono<User> fetchUser(String userName) {
    return fetchDomain.fetchOneQueryDataMono(
                    SACApiEnum.USER.getPath(),
                    SACApiEnum.USER.getQuery(userName)
            )
            .map(data -> userDomain.makeUserObject(data));
}

private Mono<Void> insertUser(User user) {
    return Mono.fromRunnable(() -> userRepository.insertUser(user));
}

...
```

## ì„¸ë¶€ ë©”ì†Œë“œë“¤

### .****fromIterable()  (fromArray)****

- ì»¬ë ‰ì…˜ ì´ìš©í•˜ì—¬ (ë°°ì—´ì´ë©´ .fromArray()) í”ŒëŸ­ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ Flux.fromIterable ì‚¬ìš© ê°€ëŠ¥
- **ì¶œë ¥ ìˆœì„œ ë³´ì¥ (from Arrayë„ ë§ˆì°¬ê°€ì§€)**

```java
import reactor.core.publisher.Flux

fun main() {
   val avengers = listOf(
       Hero("Iron Man", "Tony Stark"),
       Hero("Black Widow", "Natasha Romanoff"),
       Hero("Captain America", "Steve Rogers"),
       Hero("Thor", "Thor Odinson"),
       Hero("Hulk", "Bruce Banner"),
       Hero("Hawkeye", "Clint Barton"),
       Hero("Black Panther", "T'Challa"),
   )

   val flux: Flux<Hero> =
       Flux.fromIterable(avengers)

   flux.subscribe(::println)
}

--------------------
ì¶œë ¥ ê²°ê³¼)
--------------------
Hero(nickname=Iron Man, name=Tony Stark)
Hero(nickname=Black Widow, name=Natasha Romanoff)
Hero(nickname=Captain America, name=Steve Rogers)
Hero(nickname=Thor, name=Thor Odinson)
Hero(nickname=Hulk, name=Bruce Banner)
Hero(nickname=Hawkeye, name=Clint Barton)
Hero(nickname=Black Panther, name=T'Challa)
```

### .**then()**

- ìˆœì°¨ ì‹¤í–‰

```java
// fetchProblemsMono -> processUserTierê°€ ì™„ë£Œëœ í›„ì— processUserTierProblem ì‹¤í–‰
  return fetchProblemsMono
          .then(fetchUserTierMono)
          .then(Mono.defer(() -> fetchUserTierProblem(user)));
});
```

### **.zip()**

- ë³‘ë ¬ ì‹¤í–‰
- ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
- **ì§€ì •ëœ ìˆœì„œ ë³´ì¥**

```java
// ë³‘ë ¬ë¡œ ì‹¤í–‰
return Flux.zip(insertUserMono, fetchProblemsMono, fetchUserTierMono, fetchUserTierProblemMono)
        .then(Mono.empty()); // 3ê°œì˜ ì‘ì—… ë‹¤ ì™„ë£Œ ë˜ì–´ì•¼ thenìœ¼ë¡œ ë„˜ì–´ê°
```

### .merge()

- Flux.mergeëŠ” í”ŒëŸ­ìŠ¤ë¥¼ ì œê³µë°›ì€ ìˆœì„œëŒ€ë¡œ ê²°í•©í•˜ëŠ” íŒ©í† ë¦¬ í•¨ìˆ˜
- zip í•¨ìˆ˜ì™€ ì°¨ì´ë¼ë©´ íŠœí”Œ ê°ì²´ë¡œ í•©ì³ì§€ì§€ ì•ŠìŒ
- ë³‘ë ¬ ì‹¤í–‰
- **ì§€ì •ëœ ìˆœì„œ ë³´ì¥**
- `mergeSequential` ë„ ìˆœì„œ ë³´ì¥
- .next() : ì²« ë²ˆì§¸ ì™„ë£Œëœ ì‘ì—…ë§Œ ì„ íƒ

```java
package flux

import reactor.core.publisher.Flux

fun main() {
    val three = Flux.just("three")
    val two = Flux.just("two")
    val one = Flux.just("one")

    val flux: Flux<String> = Flux.merge(three, two, one)
    flux.subscribe(::println)
}

--------------------
ì¶œë ¥ ê²°ê³¼)
--------------------
three
two
one

		val flux: Flux<String> = Flux.mergeSequential(three, two, one)
    flux.subscribe(::println)

--------------------
ì¶œë ¥ ê²°ê³¼)
--------------------
three
two
one
```

### .****concat() vs .mergeSequential()****

- ì—¬ëŸ¬ê°œì˜ í”ŒëŸ­ìŠ¤ë¥¼ ì¸ìë¡œ ì „ë‹¬ë°›ì•„ í•˜ë‚˜ë¡œ ê²°í•©í•œ í›„ì— ìˆœì„œëŒ€ë¡œ êµ¬ë…ì²˜ë¦¬
- **ë‘˜ ë‹¤ ìˆœì„œ ë³´ì¥ì´ ë˜ì§€ ì•ŠìŒ**
- `mergeSequential` : ì—¬ëŸ¬ê°œì˜ í”ŒëŸ­ìŠ¤ë¥¼ ë³‘ë ¬ë¡œ êµ¬ë… ì²˜ë¦¬í•˜ê³  ìµœì¢… ë³€í™˜ ì‹œ ì¸ìë¡œ ì§€ì •í•œ êµ¬ë… ìˆœì„œì— ë”°ë¼ ìƒˆë¡œìš´ í”ŒëŸ­ìŠ¤ë¡œ ê²°í—™

```java
package flux

import reactor.core.publisher.Flux
import java.time.Duration

fun main() {
    val one = Flux.just("one").delayElements(Duration.ofMillis(300))
    val two = Flux.just("two").delayElements(Duration.ofMillis(400))
    val three = Flux.just("three").delayElements(Duration.ofMillis(500))

    val flux: Flux<String> = Flux.concat(three, two, one)
    flux.subscribe(::println)

    Thread.sleep(Duration.ofSeconds(2).toMillis())
}

--------------------
ì¶œë ¥ ê²°ê³¼)
--------------------
three
two
one
```

## ì˜¤ëŠ˜ êµ¬í˜„ ë‚´ìš©

1. ì¿ í‚¤ CORS ë¬¸ì œ í•´ê²°
2. recomproblem ë¡œì§ êµ¬í˜„ ì™„ë£Œ
3. ìœ ì € 1ëª… ë“±ë¡ ë¹„ë™ê¸° ë¡œì§ êµ¬í˜„ ì™„ë£Œ
    1. í•˜ì˜€ìœ¼ë‚˜ ëˆ„ë”ê¸° ì½”ë“œì—¬ì„œ ë¹„ë™ê¸°ë¼ì„œ http returnì„ ëª»í•¨;;;;
    2. ë‚˜ì¤‘ì— Monoë‘ Fluxë¥¼ ë¦¬í„´í•˜ë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•´ë³´ì (í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°)
4. ìœ ì € ê¸°ë³¸ ì´ë¯¸ì§€ ëœë¤ìœ¼ë¡œ ì œê³µ
5. Vue login, group page ì‘ì„±ì¤‘

## ë‚´ì¼ í•  ì¼

- ë·°.. ë„ˆë¬´ í• ê²Œ ë§ë‹¤..

ì¶”ê°€ ê³ ë¯¼
ì•Œê³ ë¦¬ì¦˜ì´ ì—†ëŠ” ê²½ìš° ì–´ë–»ê²Œ í•˜ëŠ”ê°€?

# ğŸ˜œÂ Todayâ€™s Small Happiness

- ê·¸ë˜ë„ ë°±ì€ ì–´ëŠì •ë„ ë—!

# ğŸ§Â Letâ€™s Think About It

- Reactor ë” ê³µë¶€

# ğŸ™€Â Got Stuck..

- Reactor, í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° ê°œì–´ë µë‹¤â€¦.