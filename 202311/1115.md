# TIL (Today I Learned)

# 11ì›” 15ì¼ ìˆ˜ìš”ì¼

# ğŸ˜ƒÂ What I Learned

## lombok ì‚¬ìš© ì•ˆë˜ëŠ” ì´ìŠˆ

- **ë¡¬ë³µì€ ì˜ì¡´ì„± ë“±ë¡ë§Œìœ¼ë¡œ ì•ˆëœë‹¤.. ë”°ë¡œ ì„¤ì¹˜ë¥¼ í•´ì¤˜ì•¼í•œë‹¤..**!
- ì˜ì¡´ì„± ë“±ë¡ì€ ì²˜ìŒì— starterì—ì„œ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.
- [ì¸í…”ë¦¬ì œì´ì—ì„œ ì„¤ì¹˜í•˜ëŠ” ë²•](https://technote-mezza.tistory.com/109)
- **ì°¸ê³ **
    - `@Data` = `@Getter`,Â  `@Setter`,Â  `@RequiredArgsConstructor`,Â  `@ToString`,Â  `@EqualsAndHashCode`

## SQL ì˜ˆì•½ì–´ ì´ìŠˆ

- **rankë¥¼ column ëª…ìœ¼ë¡œ ë“±ë¡í•´ë‘ì—ˆëŠ”ë° ì•Œê³ ë³´ë‹ˆ [ì˜ˆì•½ì–´](https://passwd.tistory.com/entry/MySQL-%EC%88%9C%EC%9C%84-%ED%95%A8%EC%88%98)ì˜€ë‹¤..**
    - rank( ) : íŒŒí‹°ì…˜ ë‚´ì˜ í˜„ì¬ í–‰ì˜ ìˆœìœ„ë¥¼ ë°˜í™˜í•˜ê³ , ê³µë™ ìˆœìœ„ëŠ” ê°™ê²Œ, ë‹¤ìŒ ìˆœìœ„ëŠ” ê·¸ ìˆ˜ë§Œí¼ ê±´ë„ˆë›°ì–´ ë§¤ê²¨ì§„ë‹¤.
- í•´ê²°í•˜ê¸° ìœ„í•´ì„œ rank â†’ solved_acë¡œ ë³€ê²½..

## SQL INSERT ì¤‘ë³µ ë°ì´í„° ë„£ì§€ ì•Šê¸° (IGNORE)

- IGNORE : PK ë‚˜ ì¤‘ë³µë˜ì§€ ì•Šì•„ì•¼ í•˜ëŠ” ë°ì´í„°ê°€ ì¤‘ë³µì‹œ ë¬´ì‹œí•´ì¤€ë‹¤

```java
@Insert("INSERT IGNORE INTO problem_algorithm (problem_num, algorithm) VALUES (#{problemNum}, #{algorithm})")
public int insertAlgorithm(@Param("problemNum") int problemNum, @Param("algorithm") String algorithm);
```

## [SpringBoot 3.0 - MyBatis mapper.xml ì‚¬ìš© ì•ˆí•˜ê¸°](https://terianp.tistory.com/113)

- **ì„±ê³µ!**
- **ì–´ë–»ê²Œ ê°€ëŠ¥í•œ ê²ƒì¸ê°€?**
    - MyBatis 3.0 ì´ìƒë¶€í„° Annotation ì§€ì›
    - SpringBoot 3.0ë¶€í„° MyBatis 3.0 ì§€ì›
    - **ì°¸ê³ ë¡œ Annotation ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ MyBatis-Spring ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ëŠ¥í•œ ê²ƒ**
- **ì„ ì • ì´ìœ **
    - í›„ì— JPAê°€ ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ sqlì„ ì‚¬ìš©í•œë‹¤ê³  í•´ì„œ annotationì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ ì—°ìŠµí•˜ê¸° ìœ„í•¨

### **ì²˜ìŒ í–ˆë˜ ë»˜ì§“**

- DB Configë‘ mapperëŠ” ë§Œë“¤ì–´ì„œ bean ë“±ë¡í•˜ë„ë¡ ë§Œë“¤ê³  sql ë¬¸ì„ Annotationí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì‚¬ìš© (ë”ì°í•œ í˜¼ì¢…..)
- ì•„ë˜ëŠ” DBConfigë¥¼ í†µí•´ Mapperë¥¼ beanìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ê³¼ì •

```java
@Configuration
@MapperScan(basePackages = "com.ssafypjt.bboard.model.repository")
public class DBConfig {

}
```

### Mapper.xml ì•ˆ ì‚¬ìš©í•˜ë„ë¡ ì½”ë“œ ìˆ˜ì •í•˜ê¸°

- [application.properties](http://application.properties) mapper ìœ„ì¹˜ ì§€ì •í•˜ëŠ” ì •ë³´ ì‚­ì œ

```java
# mybatis
#mybatis.mapper-locations=classpath*:mappers/*.xml #ì‚¬ìš© ì•ˆí•¨!
```

- DB Config ì‚­ì œ (mapper scan ì‚¬ìš© ì•ˆí•¨)
- Mapper.xmlë“¤ ì‚­ì œ
- ì‚¬ìš© ì˜ˆì‹œëŠ” ì•„ë˜ì™€ ê°™ìŒ
    - @Mapperë§Œ ì‚¬ìš©í•˜ë©´ ë¨

```java
@Mapper
public interface UserRepository {

    @Select("SELECT user_id as userId, user_name as userName, tier, solved_rank as solvedRank, img_url as imgUrl\n" +
            " FROM users WHERE user_id = #{id}")
    public User selectUser(int id);

    @Insert("INSERT INTO users (user_name, tier, solved_rank, img_url) VALUES (#{userName}, #{tier}, #{solvedRank}, #{imgUrl})")
    public int insertUser(User user);

...

}
```

## JsonNode (Jackson)

- json tree êµ¬ì¡°ë¥¼ ê°€ì§„ ê°ì²´
- json ë¬¸ì„œì˜ ì „ë¶€ í˜¹ì€ ì¼ë¶€ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” ê°ì²´
- **ì‚¬ìš© ì½”ë“œ**
    - **ì½”ë“œ êµ¬ì¡°**
    - **item**
        - **problemId**
        - **titleKo**
        - **level**
        - **tags**
            - **key**

```java
try {
      // Request Header ì„¤ì •
      HttpHeaders headers = new HttpHeaders();
      headers.setContentType(MediaType.APPLICATION_JSON);

      // ObjectMapper ìƒì„±
      ObjectMapper objectMapper = new ObjectMapper();
      // JSON ê°ì²´ ìƒì„±
      ObjectNode requestBody = objectMapper.createObjectNode();

      // Request Entity ìƒì„±
      HttpEntity entity = new HttpEntity(requestBody.toString(), headers);

      // API í˜¸ì¶œ
      // í˜ì´ì§€ 1ê°œë§Œ ë°›ì•„ì˜´ (ì›ë˜ 2ê°œ ë°›ì•„ì™€ì•¼í•¨)
      String url = "https://solved.ac/api/v3/search/problem?query=@" + user.getUserName() + "&sort=level&direction=desc&page=1";
      ResponseEntity<String> response = restTemplate.exchange(url, HttpMethod.GET, entity, String.class);

      // ì‘ë‹µì˜ Content-Typeì„ í™•ì¸í•˜ê³ , UTF-8ë¡œ ë””ì½”ë”©í•˜ì—¬ ì¶œë ¥
      HttpHeaders responseHeaders = response.getHeaders();
      MediaType contentType = responseHeaders.getContentType();
      Charset charset = contentType.getCharset();

			// ì—¬ê¸°ì„œ JsonNode ì‚¬ìš©
      try {
					// JSON ê°ì²´ë“¤ì„ ë“¤ê³ ìˆëŠ” JsonNode
          JsonNode itemsNode = objectMapper.readTree(response.getBody()).get("items");
					// JsonNodeì•ˆì— JsonNodeì´ ì¡´ì¬í•˜ëŠ” êµ¬ì¡°
          for (JsonNode node : itemsNode) {
							// JSONnode -> Problem dto ë³€í™˜ 
              Problem problem = objectMapper.convertValue(node, Problem.class);

              // ì•Œê³ ë¦¬ì¦˜ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œ 
              JsonNode algorithmNode = node.get("tags");
              StringBuilder algorithm = new StringBuilder();
              for (JsonNode aNode : algorithmNode) { // 
                  algorithm.append(aNode.get("key").asText()).append(" ");
              }
              // ì—¬ê¸°ê¹Œì§€
              problemRepository.insertAlgorithm(problem.getProblemNum(), algorithm.toString()); // ì•Œê³ ë¦¬ì¦˜ í…Œì´ë¸” ì‚½ì…

              problem.setUserId(user.getUserId());
              System.out.println(problem);
              count += problemRepository.insertProblem(problem);
          }
      } catch (Exception e) {
          e.printStackTrace();
      }

  } catch (Exception e) {
      System.out.println("error");
  }
```

- **DTOì— ì„¤ì •**
    - **@JsonProperty(" ") : JSONì— í•´ë‹¹ keyì˜ ê°’ì„ í•´ë‹¹ dto ì˜ í•„ë“œê°’ìœ¼ë¡œ ë°›ê² ë‹¤ê³  ì§€ì •**
    - **@JsonIgnoreProperties(ignoreUnknown = true) : ì§€ì •í•œ keyê°’ ë¹¼ê³ ëŠ” ë¬´ì‹œí•˜ë„ë¡ ì§€ì •í•´ì•¼í•¨**

```java
@JsonIgnoreProperties(ignoreUnknown = true)
public class Problem {
    private int id = 0;
    private int userId = 0;
    @JsonProperty("problemId")
    private int problemNum;
    @JsonProperty("level")
    private int tier;
    @JsonProperty("titleKo")
    private String title;
}
```

# ğŸ˜œÂ Todayâ€™s Small Happiness

- Backend - ì™¸ë¶€ API - DBì—°ë™ ì„±ê³µ!

# ğŸ§Â Letâ€™s Think About It

- hikarië¼ëŠ” connection poolì´ ìˆëŠ” ê²ƒ ê°™ë‹¤. ìì„¸íˆ ì•Œì•„ë³´ì§€ëŠ” ì•Šì•˜ì§€ë§Œ api ìš”ì²­ ë™ì‹œì— ë°›ì„ ë•Œ connection ì„ ì¡°ê¸ˆ ë” ë¹ ë¥´ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ?
    - ì¼ë‹¨ application.propertiesì— ì„¤ì •ë§Œ í•´ë‘ . ì‚¬ìš©ë²•ì€ ë‚˜ì¤‘ì— ê³µë¶€
- ê³ ë¯¼í•  ë¶€ë¶„ : ìœ ì €ë¥¼ 30ëª…ìœ¼ë¡œ ì œí•œí•˜ëŠ”ë° ìœ ì €ê°€ ì˜ëª»ë“¤ì–´ê°€ë©´ ìœ ì €ë¥¼ ì‚­ì œí•˜ê¸°ë„ í•´ì•¼ í•  ê²ƒ ê°™ì€ë°.. ì´ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ìœ ì €ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë˜ ë”°ë¡œ ë¶€ì—¬í•´ì•¼ í•˜ëŠ”ì§€ ì•„ë‹ˆë©´ ìœ ì €ì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ì ìš©í• ì§€ (ê·¸ëŸ¬ë©´ ë˜ ì–´ë””ì— ë¹„ë°€ë²ˆí˜¸ ì €ì¥í• ì§€..)

# ğŸ™€Â Got Stuck..

-